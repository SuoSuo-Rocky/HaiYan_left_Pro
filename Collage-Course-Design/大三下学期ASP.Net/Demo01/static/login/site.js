Bx.Environment.addPlugin("daojishi","Bx.Plugin.Others.Daojishi","/plugins/daojishi/js.js"),Bx.Environment.addPlugin("msscomment","Bx.Plugin.Others.MssComment","/plugins/msscomment/js.js"),Bx.Environment.addPlugin("saishimap","Bx.Plugin.Others.SaishiMap","/plugins/saishimap/js.js");var webPages=bxPub.extend(webPages||{},{});webPages.site=bxPub.extend(webPages.site||{},function(){var t=[],i={funs:function(){var o=bxGetBodyDocumentElement(),r={},i="",f=[],e=[],u=!1;return bxGetUrlParam("vs")!=""&&bxCookie.add("visitsource",bxGetUrlParam("vs"),1440),{global:{defaultLang:"cn",langList:["cn","en"],langWords:{searchErrorMessage:{cn:"请输入搜索关键词",en:""}},isCrossDomainEnabled:window.XMLHttpRequest!=undefined&&"withCredentials"in new window.XMLHttpRequest,htmlEnabled:!0,memberId:0,wxOpenAppId:"",wxOpenAppAppId:"",wxOpenUrlHead:"",wxMpAppId:"wxb5636d699fc1b88b",wxMpUrlHead:"api.chinarun.com",loginWayDefaultWap:"normal",loginWayDefaultWeixin:"normal",daojishi:(new Date).addSeconds(-1),team:{name:"战队",typeName:{1:"私密战队",2:"公开战队",4:"加密战队"}}},isMobile:o.clientWidth<=720||bxNavigator.mobile,runJs:function(n,t){if(n!=!1&&n!=null&&n!=undefined)return typeof n=="string"?bxPub.getJson(n):typeof n=="function"?n(t):void 0},showMessage:function(n,t){return t&&(n.dialog=t),gui().dialog.alert(n)},confirm:function(n,t){var i=bxPub.extend({},typeof n=="object"?n:{message:n});return n.callBackOk&&(n.onOK=n.callBackOk),t&&(n.dialog=t),gui().dialog.confirm(n)},getJsonpURL:function(n){var t=bxPub.getJsonValue(window.ssGlobal||{},"jsonp","");return t=="/"?n:t+n},getCORSURL:function(t){return this.global.isCrossDomainEnabled&&(t==""?t=n.getJsonpURL(window.location.pathname+window.location.search):t[0]=="/"&&(t=n.getJsonpURL(t))),t},showWaiting:function(n){return gui().dialog.waiting(n)},pageAPI:function(t,i,r,u,f){return t==""&&(t=window.location.pathname+window.location.search),t=this.getCORSURL(t),t=bxPub.replaceUrlParam("lang",n.getLang(),t),bxPageAPI(t,i,r,u,f)},userPageAPI:function(n,t,i,r){return this.pageAPI("/api/",n,t,i,bxPub.extend({appId:"SSMember"},r||{}))},sitePageAPI:function(n,t,i,r){return this.pageAPI("/api/",n,t,i,bxPub.extend({appId:"SSSite"},r||{}))},checkMemberName:function(n,t,i,r){var n=$(n),t=$(t);this.userPageAPI("checkusername",{name:n.val().trim()},function(n){n==0?bxValSetMessage(t,!0,i):bxValSetMessage(t,!1,r)})},checkMemberEmail:function(n,t,i,r){var n=$(n),t=$(t);this.userPageAPI("checkemail",{email:n.val().trim()},function(n){n==0?bxValSetMessage(t[0],!0,i):bxValSetMessage(t[0],!1,r)})},checkMemberMobile:function(n,t,i,r){var n=$(n),t=$(t);this.userPageAPI("checkmobile",{mobile:n.val().trim()},function(n){n==0?bxValSetMessage(t,!0,i):bxValSetMessage(t,!1,r)})},getTopMemberInfo:function(n){this.getMemberLoginInfo({type:"pagetop",callBack:function(t,i,r){t==0&&($(n.target).html(r.get("htmltext")),n.callBack&&n.callBack())}})},getLang:function(n){var t=window.location.pathname.toLowerCase().substr(1),r=this.global.defaultLang,i;return t==""||t.indexOf("/")<0?n===!1?"":r:(i=t.substr(0,t.indexOf("/")),this.global.langList.indexOf(i)>=0)?i:n===!1?"":r},getWords:function(n){var i=this.getLang(),t;return typeof n=="object"?n.hasOwnProperty(i)?n[i]:n.hasOwnProperty(this.global.defaultLang)?n[this.global.defaultLang]:"":(t=this.global.langList.indexOf(i),arguments.length>t)?arguments[t]:(t=this.global.langList.indexOf(this.global.defaultLang),arguments.length>t)?arguments[t]:""},getWord:function(n){var i=this.getLang(),t=this.langWords[n];return t[i]?t[i]:t[this.global.defaultLang]},createImagePlayer:function(n){var n=bxPub.extend({target:".divArtContent"},n),i=$(n.target),r=i.find("img"),t;r.length!=0&&(t=0,r.each(function(){var n=$(this),i;n.parents("A").length>0||n.hasClass("notauto")||n.parents(".notauto").length>0||(n.addClass("imgSlideItem"),i=$("<a href='{0}' target='_blank' class='aSlideItem'><\/a>".format(n[0].src)),i.attr("title",n.alt),n[0].big=n[0].big||n[0].src,i.insertAfter(n),n.appendTo(i),t++)}),t>0&&bxPlugin.initImagesPlayer(i[0],2))},getMemberLoginInfo:function(t){var t=bxPub.extend({type:"",callBack:function(){}},t||{});n.userPageAPI("getlogininfo",{type:t.type},t.callBack)},showMemberLogin:function(t){var i,r;if(t&&t.useOpenMode)return i=function(){webPages.site.___openwindow=null,t.callBack&&t.callBack()},webPages.site.___openwindow=bxOpenWindow("","/"+n.getWords("html","en","jp")+"/memberloginwin.html?cmd=close","width:700px;","right:10px;","scrolling:auto;",i),webPages.site.___openwindow;r="/"+n.getWords("html","en")+"/memberlogin.html?ReturnURL="+encodeURIComponent(window.top.location.href),window.top.location.href=r},runMemberLogined:function(t){var t=bxPub.extend({callBack:function(){},useOpenMode:!0},t||{});n.getMemberLoginInfo({callBack:function(i,r,u){if(i==0){if(u.getInt("userid")>0)n.setMemberId(u.getInt("userid")),t.callBack(i,r,u);else if(t.useOpenMode==!0)webPages.site.showUserLoginWin(null,function(){n.getMemberLoginInfo({callBack:function(i,r,u){i==0?u.getInt("userid")>0&&t.callBack(i,r,u):n.showMessage({message:r})}})});else if(t.useOpenMode==!1){var f="/"+n.getWords("html","en")+"/memberlogin.html?ReturnURL="+encodeURIComponent(window.top.location.href);window.top.location.href=f}}else n.showMessage({message:r})}})},runLogined:function(t){var t=bxPub.extend({asyn:!0,logined:function(){}},t),i=function(){n.getMemberLoginInfo({callBack:function(t,i,r){if(t==0){if(r.getInt("userid")>0)n.setMemberId(r.getInt("userid")),options.callBack(t,i,r);else if(options.useOpenMode==!0)webPages.site.showUserLoginWin(null,function(){n.getMemberLoginInfo({callBack:function(t,i,r){t==0?r.getInt("userid")>0&&options.callBack(t,i,r):n.showMessage({message:i})}})});else if(options.useOpenMode==!1){var u="/"+n.getWords("html","en")+"/memberlogin.html?ReturnURL="+encodeURIComponent(window.top.location.href);window.top.location.href=u}}else n.showMessage({message:i})}})};t.asyn?setTimeout(function(){i()},1e3):i()},memberLogout:function(t){var t=bxPub.extend({success:function(){window.top.location.href=n.getWords("/","/en/")}},t),i=n.showWaiting();n.userPageAPI("logout",{},function(n,r){i.close(),n==0?t.success&&t.success():alert(r)})},addGBookMessage:function(t,i,r){var u=bxWaiting({title:"正在提交您的信息",message:"正在提交您的信息，请稍后..."});n.pageAPI("","addGBookMessage",bxPub.extend(t,{group:i}),function(t,i,f){if(r&&r(t,i,f)===!1){u.close();return}t==0?n.showMessage({message:"提交成功，感谢您的参与",onClosed:function(){window.location.href=window.location.href}},u):n.showMessage({message:"提交失败，请重试或联系客服<br />"+i},u)})},playVideo:function(n){var n=bxPub.extend({target:$(),width:"100%",height:"100%",videos:[],autoplay:!0,loop:!1,success:function(){}},n);bxPlugin.run("ckplayer",function(){var t,r,i,u;n.target=$(n.target),t=n.target.attr("id"),(t==null||t=="")&&(t=bxPub.getUniqueID(),n.target.attr("id",t)),r=[],n.videos.each(function(n){typeof n=="string"?r.push([n,"video/mp4","",0]):bxPub.checkIsArray(n)&&r.push(n)}),i=bxPub.extend({container:"#"+t,variable:"player",video:r},n),delete i.videos,delete i.target,delete i.success,u=new ckplayer(i),n.success&&n.success(u),n.autoplay&&bxNavigator.mobile&&n.target.find("video").click()},!0)},playVideoOpen:function(n){var t=bxCreateMessageBox({title:n.title||"视频",className:"box_video",style:"width:"+(n.width||"90%"),content:"<div class='divPlayer' style=';height:"+(n.height||"90%")+"'><div class='loading'><\/div>视频加载中...<\/div>"});t.show(),this.playVideo(bxPub.extend({target:t.find(".divPlayer")},n))},fixArticle:function(t){var u=$("#spArticleHits"+t),i,r;u.length>0&&$.ajax(n.getJsonpURL("/api/ss/site?method=getarticlehits&aid="+t),{dataType:"jsonp",success:function(n){u.html(n.data.hits)}}),i=$("#aArticlePre"+t),i.length>0&&i.html()==""&&(i.html(n.getWords("没有了","no")),i[0].href="#none"),r=$("#aArticleNext"+t),r.length>0&&r.html()==""&&(r.html(n.getWords("没有了","no")),r[0].href="#none")},addResize:function(n){t.push(n)},resize:function(){t.each(function(n){n()})},initResize:function(){var n=this.resize,t=0;bxSys.addEvent(window,"onresize",function(){clearTimeout(t),t=setTimeout(function(){n()},10)}),addOnload(n),$(document).ready(function(){n()})},setMemberId:function(n){this.global.memberId=n},getMemberId:function(){return this.global.memberId},addUserFav:function(t,i,r){n.runMemberLogined({callBack:function(){n.userPageAPI("addfav",{favid:t,groupname:i},function(t,i){t==0?r?r():n.showMessage({title:"收藏成功",message:"收藏成功"}):n.showMessage({title:"收藏失败",message:i})})}})},createCommentPnl:function(n){bxPlugin.run("msscomment",function(){bxMssComment.create(n)},!0)},setTestModeEnabled:function(){var n=bxGetUrlParam("siteid");n.length>0&&$("A").each(function(){this.href.indexOf("javascript:")>=0||(this.href=bxUrlReplaceValue("siteid",n,this.href))})},getDownloadUrl:function(n,t,i){return(i?i:"")+"/api/ss/site/?method=downfile&file="+encodeURIComponent(n)+"&name="+(t?encodeURIComponent(t):"")},showBoxOfCjzsQuery:function(t){var t=bxPub.extend({className:"box_cjzsquery",title:n.getWords({cn:"成绩证书查询",en:"Query Results"}),message:n.getWords({cn:"请输入您的证件号码查询您的成绩证书",en:"Please enter your ID number"}),inputs:[{name:"num",remark:n.getWords({cn:"证件号码",en:"Passport ID"})}],callBackOk:function(i){var f,r,u;if(i.num.trim()=="")return n.showMessage({message:n.getWords({cn:"请检查输入",en:"Please check input"})}),!1;f=n.getLang(),r="/"+(f=="cn"?"html":f)+"/cjzs.html";for(u in t.ps)t.ps.hasOwnProperty(u)&&(r=bxPub.replaceUrlParam(u,t.ps[u],r));window.location.href=bxPub.replaceUrlParam("num",i.num.trim(),r)}},t||{}),i;t.inputs.insertAt(0,{type:"remark",value:t.message}),i=bxPrompt(t)},showBoxOfLqdQuery:function(t){var t=bxPub.extend({className:"box_lqdquery",title:n.getWords({cn:"领物单查询",en:"Query Results"}),message:n.getWords({cn:"请输入您的证件号码查询您的领物单",en:"Please enter your ID number"}),inputs:[{name:"num",remark:n.getWords({cn:"证件号码",en:"Passport ID"})}],callBackOk:function(i){var f,r,u;if(i.num.trim()=="")return n.showMessage({message:n.getWords({cn:"请检查输入",en:"Please check input"})}),!1;f=n.getLang(),r="/"+(f=="cn"?"html":f)+"/lqd.html";for(u in t.ps)t.ps.hasOwnProperty(u)&&(r=bxPub.replaceUrlParam(u,t.ps[u],r));window.location.href=bxPub.replaceUrlParam("num",i.num.trim(),r)},ps:{}},t||{}),i;t.inputs.insertAt(0,{type:"remark",value:t.message}),i=bxPrompt(t)},initDaojishi:function(t){var t=bxPub.extend({target:$(".divDaojishi"),time:n.global.daojishi,onEnd:function(){}},t||{});(t.target=$(t.target),t.target.length!=0)&&bxPlugin.run("daojishi",function(){t.target.each(function(){Bx.Plugin.Others.Daojishi.create({target:this,time:t.time,onEnd:t.onEnd})})},!0)},sendSmsVerify:function(t){var t=$.extend({mobile:"",name:"",btn:$(),type:""},t||{}),u,i;if(t.btn=$(t.btn),!/^1\d{10}$/.test(t.mobile)){n.showMessage({message:"手机号码格式不正确"});return}if(r[t.name]&&bxTimeHelper.getTimeSpan(new Date,r[t.name]).tss<60){n.showMessage({message:"验证码发送间隔时间不能少于1分钟"});return}i=t.btn.length>0,i?t.btn.each(function(){this.tagName=="INPUT"?($(this).data("oldvalue")||$(this).data("oldvalue",this.value),this.value="正在发送验证码"):($(this).data("oldvalue")||$(this).data("oldvalue",this.innerHTML),this.innerHTML="正在发送验证码")}):u=bxWaiting({message:"正在发送验证码"}),n.sitePageAPI("sendSmsVerifyCode",{mobile:t.mobile,name:t.name,type:t.type},function(f,e){if(f==0){if(r[t.name]=new Date,i)var o=setInterval(function(){var n=Math.max(0,60-bxTimeHelper.getTimeSpan(new Date,r[t.name]).tss);n>=0?t.btn.each(function(){this.disabled=!0,this.tagName=="INPUT"?this.value="重新发送("+n+")":this.innerHTML="重新发送("+n+")"}):oopts.btn.each(function(){clearInterval(o),this.disabled=!1,this.tagName=="INPUT"?this.value=$(this).data("oldvalue"):this.innerHTML=$(this).data("oldvalue")})},1e3)}else i?(n.showMessage({message:e}),t.btn.each(function(){this.tagName=="INPUT"?this.value=$(this).data("oldvalue"):this.innerHTML=$(this).data("oldvalue")})):n.showMessage({message:e},u)})},wxGetOpenId:function(t){var t=bxPub.extend({appId:n.global.wxMpAppId,host:n.global.wxMpUrlHead,scope:"snsapi_base",autoredirect:!0,cache:"local"},t),u=function(){var i=t.appId+"_weixinopenid_"+t.scope,r,n;if(t.cache=="local"&&window.localStorage&&bxNavigator.weixin)try{if(n=window.localStorage.getItem(i),r=Date.parse(window.localStorage.getItem(t.appId+"_weixinopenid_"+t.scope+"_expiretime")),n.length>0&&r>new Date)return n}catch(u){}else if(n=bxPub.sessionStorageGetItem(i),n&&n.length>0)return n;return""},i=u(t.scope),r,f;return(i==""&&t.scope=="snsapi_base"&&(i=u("snsapi_userinfo")),i!="")?i:(t.autoredirect&&(bxPub.sessionStorageSetItem("ReturnUrl",window.location.href),r="",/^\d+$/.test(t.appId)?r="http://"+t.host+"/api/ss/weixin/"+t.appId+"?method=openid&scope="+t.scope+"&redirect_uri="+encodeURIComponent(window.location.protocol+"//"+window.location.host+"/html/wxopenid.html?appid="+t.appId+"&cache="+t.cache+"&scope="+t.scope):(f=encodeURIComponent(window.location.protocol+"//"+window.location.host+"/html/wxopenid.html?appid="+t.appId+"&cache="+t.cache+"&scope="+t.scope),r="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t.appId+"&redirect_uri="+encodeURIComponent(window.location.protocol+"//"+t.host+"/api/ss/weixin/"+t.appId+"?method=openid&rtn="+f)+"&response_type=code&scope="+t.scope+"&state=#wechat_redirect"),window.location.href=r),"")},wxSetOpenId:function(t){var t=bxPub.extend({appId:n.global.wxMpAppId,host:n.global.wxMpUrlHead,openId:"",scope:"snsapi_base",autoredirect:!0,cache:"local"},t),u=t.openId,f=t.cache,i=t.scope,r=t.appId;i==""&&(i="snsapi_base"),f=="local"&&bxNavigator.weixin?(window.localStorage.setItem(r+"_weixinopenid_"+i,u),window.localStorage.setItem(r+"_weixinopenid_"+i+"_expiretime",(new Date).addDays(10).format("yyyy/MM/dd HH:mm:ss"))):bxPub.sessionStorageSetItem(r+"_weixinopenid_"+i,u)},wxCheckSubscribe:function(t){var t=bxPub.extend({appId:n.global.wxMpAppId,host:n.global.wxMpUrlHead,openid:"",callBack:function(){}},t),i=t.openid!=""?t.openid:this.wxGetOpenId({autoredirect:!1,accountId:t.accountId,host:t.host});if(i==""){t.callBack(i,!1);return}$.ajax({url:n.getJsonpURL("/api/ss/weixin/"+t.appId+"?method=checksubscribe&openid="+i),dataType:"jsonp",success:function(n){if(n.status==0&&n.data.subscribe){t.callBack(i,!0);return}t.callBack(i,!1)}})},wxJsInit:function(t){var t=bxPub.extend({appId:n.global.wxMpAppId,debug:!1,jsApiList:[],force:!1,callBackOk:function(){},callBackError:function(){}},t),o=this;if(t.force&&(i=""),i==""||i=="failure"){i="ing";var e=function(){wx.ready(function(){i="success",f.each(function(n){n()}),f=[],t.callBackOk&&t.callBackOk()})},u=0,r=function(){u++,$.ajax({url:"//api.chinarun.com/api/ss/weixin/"+t.appId+"?method=jsconfig&url="+encodeURIComponent(window.location.href.split("#")[0]),dataType:"jsonp",success:function(f){if(f.status==0){var o=f.data;o.jsApiList=["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","translateVoice","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"].concat(t.jsApiList),o.debug=t.debug,wx.error(function(t){o.debug&&n.showMessage({message:"error:"+bxPub.serialize(t)})}),wx.config(o),e()}else u<10?setTimeout(function(){r()},1e3):(i="failure",t.callBackError&&t.callBackError(f.message))}})};window.wx?r():bxSys.loadJsFile("//res.wx.qq.com/open/js/jweixin-1.4.0.js",function(){r()})}},wxReady:function(t){i=="success"?t():(f.push(t),(i==""||i=="failure")&&n.wxJsInit())},wxJsBindShare:function(t){var i=bxPub.extend({title:document.title,desc:document.title,link:window.location.href,imgUrl:"https://cdn.chinarun.com/skins/web/images/chinarun.png",timelineByDesc:!1,success:function(){},cancel:function(){}},t);n.wxReady(function(){wx.onMenuShareAppMessage({title:i.title,desc:i.desc,link:i.link,imgUrl:i.imgUrl,type:"link",dataUrl:"",success:function(){i.success()},cancel:function(){i.cancel()}});wx.onMenuShareTimeline({title:i.timelineByDesc?i.desc:i.title,link:i.link,imgUrl:i.imgUrl,success:function(){i.success()},cancel:function(){i.cancel()}});wx.onMenuShareQQ({title:i.title,desc:i.desc,link:i.link,imgUrl:i.imgUrl,success:function(){i.success()},cancel:function(){i.cancel()}});wx.onMenuShareWeibo({title:i.title,desc:i.desc,link:i.link,imgUrl:i.imgUrl,success:function(){i.success()},cancel:function(){i.cancel()}})})},wxHideAllNonBaseMenuItem:function(){n.wxReady(function(){wx.hideAllNonBaseMenuItem()})},wxShowAllNonBaseMenuItem:function(){n.wxReady(function(){wx.showAllNonBaseMenuItem()})},wxGetMemberId:function(t){var t=bxPub.extend({appId:n.global.wxMpAppId,host:n.global.wxMpUrlHead,autoredirect:!0,cache:"local",autocreate:!0},t),f=function(){var i=t.appId+"_weixinopenid_weixinmemberid",r,n;if(t.cache=="local"&&window.localStorage&&bxNavigator.weixin)try{if(n=bxPub.parseInt(window.localStorage.getItem(i),0),r=Date.parse(window.localStorage.getItem(t.appId+"_weixinopenid_weixinmemberid_expiretime")),n>0&&r>new Date)return n}catch(u){}else if(n=bxPub.parseInt(bxPub.sessionStorageGetItem(i),0),n>0)return n;return 0},r=f();if(r>0)return r;if(t.autoredirect){var i=window.location.href,e=bxPub.getUrlParam("code"),o=bxPub.getUrlParam("state");e!=""&&(i=bxPub.replaceUrlParam("code","",i)),o!=""&&(i=bxPub.replaceUrlParam("state","",i)),i=i.replace("?code=","").replace("&code=",""),i=i.replace("?state=","").replace("&state=",""),bxPub.sessionStorageSetItem("ReturnUrl",window.location.href);var u="",s=encodeURIComponent(window.location.protocol+"//"+window.location.host+"/html/wxopenid.html?appid="+t.appId+"&cache="+t.cache+"&scope=snsapi_userinfo"),h=window.location.protocol+"//"+window.location.host+"/html/wxlogin.html?appid="+t.appId+"&method=login&create="+t.autocreate+"&rtn="+s;u="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t.appId+"&redirect_uri="+encodeURIComponent(window.location.protocol+"//"+t.host+"/api/ss/weixin/"+t.appId+"?method=redirect&rtn_uri="+encodeURIComponent(h))+"&response_type=code&scope=snsapi_userinfo&state=#wechat_redirect",window.location.href=u}return 0},wxLogin:function(){},wxOAuth:function(){},wxClear:function(t){var t=bxPub.extend({appId:n.global.wxMpAppId},t||{});window.localStorage?(window.localStorage.removeItem(t.appId+"_weixinopenid_snsapi_base"),window.localStorage.removeItem(t.appId+"_weixinopenid_snsapi_userinfo"),window.localStorage.removeItem(t.appId+"_weixinopenid_snsapi_base_expiretime"),window.localStorage.removeItem(t.appId+"_weixinopenid_snsapi_userinfo_expiretime"),window.localStorage.removeItem(t.appId+"_weixinopenid_weixinmemberid"),window.localStorage.removeItem(t.appId+"_weixinopenid_weixinmemberid_expiretime")):(bxPub.sessionStorageRemoveItem(t.appId+"_weixinopenid_snsapi_base"),bxPub.sessionStorageRemoveItem(t.appId+"_weixinopenid_snsapi_userinfo"),bxPub.sessionStorageRemoveItem(t.appId+"_weixinopenid_weixinmemberid"))},wxQR:function(t){var t=bxPub.extend({container:$(),appId:"",isOpen:!1,qrType:"login",popup:!1,isWxOpenAppId:!1,urlHead:"http://api.chinarun.com",redirect_uri:"",success:function(){}},t),i={authId:"",req:null,tm:0,box:null},u=function(){var u=window.location.protocol+"//"+window.location.host+"/html/memberpassport1.html?cmd=auth&authid="+i.authId;n.createRedirectUrl({urlHead:t.urlHead,url:u,callback:function(u){var f="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+(t.appId||n.global.wxMpAppId)+"&redirect_uri="+encodeURIComponent(u.url)+"&response_type=code&scope=snsapi_userinfo#wechat_redirect";n.createRedirectUrl({urlHead:t.urlHead,url:f,callback:function(n){i.box.close(),t.popup?(i.box=bxCreateMessageBox({title:"请使用微信扫一扫完成登录",className:"box_wx_qrcode",style:"width:400px;",content:"<div class='divWxLoginQRcodeBorder'><div class='divWxLoginQRcode"+(t.isWxOpenAppId?" divWxLoginQRcode_open":"")+"' id='divWxLoginQRcode'><\/div><div class='loading'><\/div><\/div>",onClosed:function(){i.tm&&clearTimeout(i.tm),i.req&&i.req.abort()}}),i.box.show(),bxPlugin.qrcode("#divWxLoginQRcode",{text:n.url})):bxPlugin.qrcode(t.container,{text:n.url}),t.isWxOpenAppId||r()}})}})},r=function(){i.req=n.userPageAPI("weixinauth",{method:"checkauthid",authid:i.authId},function(n,u,f){if(n==0){var e=f.get("code");e==""?i.tm=setTimeout(function(){r()},500):t.success&&t.success({authId:i.authId,authCode:e})}else i.tm=setTimeout(function(){r()},500)})};i.box=n.showWaiting(),t.isOpen?n.createRedirectUrl({urlHead:n.global.wxOpenUrlHead||"http://api.chinarun.com",url:t.redirect_uri,callback:function(r){var u=r.url,f;u==""?n.showMessage({message:"请求失败，请稍后重试"},box):(i.box.close(),t.popup?(i.box=bxCreateMessageBox({title:"请使用微信扫一扫完成登录",className:"box_wx_qrcode",style:"width:400px;",content:"<div class='divWxLoginQRcodeBorder'><div class='divWxLoginQRcode divWxLoginQRcode_open' id='divWxLoginQRcode'><\/div><div class='loading'><\/div><\/div>"}),box.show(),f=new WxLogin({id:"divWxLoginQRcode",appid:t.appId||n.global.wxOpenAppId,scope:"snsapi_login",redirect_uri:u,state:"",style:"",href:""})):f=new WxLogin({id:$(t.container)[0],appid:t.appId||n.global.wxOpenAppId,scope:"snsapi_login",redirect_uri:u,state:"",style:"",href:""}))}}):n.userPageAPI("weixinauth",{method:"getauthid"},function(t,r,f){t==0?(i.authId=f.get("authid"),u(!0)):n.showMessage({message:r},box)})},createImgVerifyCode:function(t){var t=bxPub.extend({container:$(),foreColor:"FF000000",backColor:"00FFFFFF",group:"normal"},t),i;return t.container=$(t.container),t.container.html("<a href='#' class='aVcode'><img src='{0}' /> <span class='vcode_text'>{1}<\/span><\/a>".format(bxConst.Transparent1PxGifBase64Src,n.getWords("换一张","change"))),i=t.container.find(".aVcode"),i.click(function(){return i.find("img").attr("src",n.getCORSURL("/api/com/vcode/?forecolor="+t.foreColor+"&backcolor="+t.backColor+"&gname="+t.group+"&t="+bxPub.createGUID())),!1}),i.click(),{change:function(){i.click()}}},createVerifyCode:function(t){var t=bxPub.extend({name:"vcode",type:"vcode",btn:$(),input:$(),input_code:$(),inputType:"mobile|email",telVoice:"none",telId:"",onchangevcode:function(){},onpreshow:function(){}},t),i={lastSendTime:new Date("2000/1/1"),sending:!1};t.btn=$(t.btn),t.input=$(t.input),t.input_code=$(t.input_code),t.vcode=$(t.vcode);var r=function(n,t){n.each(function(){this.value!=undefined&&(this.value=t),this.innerHTML!=undefined&&(this.innerHTML=t)})},u=function(){t.inputType=="mobile"?n.showMessage({message:n.getWords({cn:"手机号码格式不正确",en:"The phone number is not formatted correctly"})}):t.inputType=="email"?n.showMessage({message:n.getWords({cn:"邮箱地址格式不正确",en:"The email address is not formatted correctly"})}):n.showMessage({message:n.getWords({cn:"格式不正确",en:"The format is incorrect"})})},f=function(){r(t.btn,n.getWords({cn:"获取验证码",en:"send code"}))},e=function(){return!i.sending&&bxTimeHelper.getTimeSpan(new Date,i.lastSendTime).tss>=60},s=function(){},o=function(){i.lastSendTime=new Date;var u=setInterval(function(){var f=Math.max(0,60-bxPub.parseInt((new Date-i.lastSendTime)/1e3));f<=0?(clearInterval(u),r(t.btn,n.getWords({cn:"重新获取",en:"reacquire"}))):r(t.btn,n.getWords({cn:"重新获取("+f+")",en:"reacquire("+f+")"}))},1e3)};f(),t.btn.click(function(){var v,c,h;if(t.onpreshow&&t.onpreshow()===!1||!e())return!1;var s="",l=!1,a=t.input[0].tagName;if(a=="INPUT"||a=="TEXTAREA"?(s=t.input.val().trim(),t.input_code.length>0&&(v=t.input_code.val().trim(),s=v+s)):s=t.input.html().trim(),/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(s)){if(t.inputType.indexOf("email")<0)return u(),!1}else if(bxPub.checkMobile(s)){if(t.inputType.indexOf("mobile")<0)return u(),!1;l=!0}else return u(),!1;return c=[{name:"code",text:{cn:"验证码",en:"code"},val:{mode:"rfv"}}],l&&t.telVoice=="select"&&c.push({name:"type",text:{cn:"通知方式",en:"method"},type:"select",list:[{text:{cn:"短信",en:"SMS"},value:"sms"},{text:{cn:"语音电话",en:"Voice"},value:"tel"}]}),h=gui().dialog.prompt({title:{cn:"获取验证码",en:"send code"},inputs:c,className:"dlg_sendcode",onOK:function(u){var l=u.data,c;return(u.cancel=!0,c={number:s,vcode:l.code,gname:"vcode",name:t.name,type:t.type,telid:t.telId},l.type=="tel"&&(c.istel=!0),c.vcode=="")?(n.showMessage({message:{cn:"请输入验证码",en:"please input the code"}}),!1):e()?(h.setWaiting(!0),r(t.btn,n.getWords({cn:"发送中",en:"sending"})),i.sending=!0,n.sitePageAPI("sendverifycode",c,function(r,u){i.sending=!1,h.setWaiting(!1),r==0?(h.close(),o()):(n.showMessage({message:u}),f(),t.onchangevcode())}),!1):!1}}),h.find("[name=code]").css({width:"100px"}),$("<span class='spCode2'><\/span>").insertAfter(h.find("[name=code]")),n.createImgVerifyCode({container:h.find(".spCode2"),group:"vcode"}),!1})},createRedirectUrl:function(n){var n=bxPub.extend({server:"//api.chinarun.com",urlHead:"http://api.chinarun.com",url:"",callback:function(){}},n);$.ajax({url:n.server+"/api/com/addredirect/",dataType:"jsonp",data:{url:n.url,head:n.urlHead},success:function(t){t.status==0?n.callback&&n.callback({url:t.data.url}):n.callback&&(console.log(t.message),n.callback({url:""}))}})},createShareAuth:function(t){var t=bxPub.extend({urlHead:"",type:"normal",source:"",expire:(new Date).addMonth(12),data:{},success:function(){},error:function(t){n.showMessage({message:t.message})}},t);$.ajax({url:t.urlHead+"/api/ss/site/?method=createshareauth",data:{type:t.type,source:t.source,data:t.data,expire:t.expire.format("yyyy-MM-dd HH:mm:ss")},dataType:"jsonp",success:function(n){n.status==0?t.success&&t.success(n.data):t.error&&t.error({message:n.message})}})},getThumbnailUrl:function(n){var n=bxPub.extend({url:"",width:300,height:0,quality:90},n),t=n.url,i;return t==""?t:(/^\/upload\/thumb\//i.test(t)||t.substr(0,1)!="/"||(t="/upload/thumb"+t,i=t.lastIndexOf("."),t=t.substr(0,i)+"_s_"+n.width+"_"+n.height+"_"+n.quality+t.substr(i)),t)},visitLogInit:function(t){var t=bxPub.extend({server:"//api.chinarun.com",add:!0,url:window.location.href,referrer:document.referrer,success:function(){}},t);if(u){t.success&&t.success();return}$.ajax({url:t.server+"/api/ss/site?method=visitloginit",dataType:"jsonp",data:{add:t.add,url:t.url,referrer:t.referrer},success:function(){if(u){t.success&&t.success();return}u=!0,e.each(function(t){n.visitLogAdd(t)}),t.success&&t.success()}})},visitLogAdd:function(n){var n=bxPub.extend({server:"//api.chinarun.com",sid:0,sid2:0,sid3:"",sourceTypeName:"",extr:null,url:window.location.href,referrer:document.referrer,success:function(){}},n);if(!u){e.push(n);return}$.ajax({url:n.server+"/api/ss/site?method=visitlogadd",dataType:"jsonp",data:{sid:n.sid,sid2:n.sid2,sid3:n.sid3,sname:n.sourceTypeName,extr:n.extr||"",url:n.url,referrer:n.referrer},success:function(t){t.status==0&&n.success&&n.success()}})},visitLogRedirect:function(t){var t=bxPub.extend({server:"//api.chinarun.com",sid:0,sid2:0,sid3:"",sourceTypeName:"redirect",extr:null,url:"",type:"top",success:function(){}},t);gui().toast.waiting(),n.visitLogAdd({server:t.server,sid:t.sid,sid2:t.sid2,sid3:t.sid3,sourceTypeName:t.sourceTypeName,url:t.url,referrer:window.location.href,success:function(){t.success&&t.success(),t.type=="open"?(gui().toast.close(),window.open(t.url)):t.type=="window"?window.location.href=t.url:t.type=="top"&&(window.top.location.href=t.url)}})}}}(),userCenter:function(){return{init:function(t){var i=this;n.runMemberLogined({callBack:function(){i.setLeftMenu(),i.autoFloatLeftMenu(),typeof t=="function"?t():t.loaded&&t.loaded(),$(".divMemberFrame").removeClass("divMemberFrame_loading")},useOpenMode:!1})},setLeftMenu:function(){var t=window.location.pathname,n;/\/(\w+)\.html/ig.test(t)&&(n=RegExp.$1.toLowerCase(),$(".divMemberLeftMenu dd A").each(function(){/\/(\w+)\.html/ig.test(this.href)&&n==RegExp.$1.toLowerCase()&&$(this).parents("dd").addClass("selected")}))},autoFloatLeftMenu:function(){var t=$(".divMemberLeftMenu"),r=t.parent(),i;if(t.length!=0&&!t.hasClass("divMemberLeftMenu_nofloat")){var u=t[0].offsetTop,e=t.offsetLeft,f=t[0].clientWidth;bxStyle.addCss(".divMemberLeftMenu_fixed{width:"+f+"px;}"),i=function(){var n=t.xy().y-bxPub.scrollTop();n<0?t.addClass("divMemberLeftMenu_fixed"):r.xy().y+u>t.xy().y&&t.removeClass("divMemberLeftMenu_fixed")},n.addResize(i),bxSys.addEvent(window,"onscroll",i),i()}}}}(),userLogin:function(){var t={quickLogin:!1,wxOpenAppId:"",wxOpenAppAppId:"",wxMpAppId:"",returnURL:"",coder:null,authId:"",way:bxPub.getUrlParam("way"),wxEnabled:!1,loginType:"normal",isApp:!1};return{init:function(i){var r=this;if(bxPub.extend(t,i),bxNavigator.weixin?t.wxMpAppId&&(t.quickLogin=t.wxEnabled=!0):n.isMobile||(t.wxMpAppId||t.wxOpenAppId)&&(t.quickLogin=t.wxEnabled=!0),t.way=="")if(bxNavigator.weixin)switch(n.global.loginWayDefaultWeixin){case"mobile":t.way="mobile";break;case"weixin":t.way="weixin"}else if(n.isMobile)switch(n.global.loginWayDefaultWap){case"mobile":t.way="mobile"}t.coder=n.createImgVerifyCode(bxPub.extend({container:"#spVcode"},bxPub.getJson($("#spVcode").p("option","{}")))),n.createVerifyCode({input:"#txtLoginMobile",btn:"#aGetMobileCode",inputType:"mobile",type:"login",name:"mobilelogin"}),t.returnURL=bxGetUrlParam("ReturnURL")!=""?bxGetUrlParam("ReturnURL"):"memberindex.html",$("#txtLoginName").attr("placeholder",n.getWords({cn:"用户名/手机/邮箱",en:"name/phone number/email"})),$("#aBtnLogin").click(function(){if(!bxVal("login"))return!1;var r={name:$("#txtLoginName").val(),psw:$("#txtLoginPsw").val(),code:$("#txtLoginVcode").val(),autologin:$("#chkRememberPassword")[0].checked},i=n.showWaiting();return n.userPageAPI("userlogin",r,function(r,u){r==0?(i.close(),bxGetUrlParam("cmd")=="close"?bxCloseOpenWindow():window.location=t.returnURL):(n.showMessage({message:u},i),t.coder.change(),$("#txtLoginVcode").val(""))}),!1}),$("#aBtnLoginRegister").attr("href","memberregister.html"+window.location.search),$("#aBtnLoginGetPsw").attr("href","membergetpsw.html"+window.location.search),$("#aBtnLogin").parents(".divForm").find(".txt").keyup(function(){bxSys.getKey().code==13&&$("#aBtnLogin").click()}),t.quickLogin?$(".divQuckLogin").show():$(".divQuckLogin").hide(),$(".aBtnLoginWeixin").click(function(){var i=window.location.protocol+"//"+window.location.host+"/html/memberpassport1.html?ReturnURL="+encodeURIComponent(t.returnURL),r;return n.isMobile?(r=bxWaiting(),n.createRedirectUrl({urlHead:n.global.wxMpUrlHead||"http://api.chinarun.com",url:i,callback:function(i){var r="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+(t.wxMpAppId||n.global.wxMpAppId)+"&redirect_uri="+encodeURIComponent(i.url)+"&response_type=code&scope=snsapi_userinfo#wechat_redirect";window.location.href=r}})):t.wxOpenAppId?n.wxQR({isWxOpenAppId:!0,appId:t.wxOpenAppId||n.global.wxOpenAppId,popup:!0,redirect_uri:bxPub.replaceUrlParam(i,"wxtype","open")}):n.wxQR({popup:!0,appId:t.wxMpAppId||n.global.wxMpAppId,success:function(n){window.location.href=bxPub.replaceUrlParam("code",n.authCode,i)}}),!1}),$("#aBtnLoginNormal").click(function(){return t.loginType="normal",$(".divForm_row_normal").show(),$(".divForm_row_mobile").hide(),!1}),$("#aBtnLoginMobile").click(function(){if(!bxVal("mobile"))return!1;var i={mobile:$("#txtLoginMobile").val().trim(),smscode:$("#txtLoginMobileCode").val().trim()};return n.userPageAPI("userloginmobile",i,function(i,r){i==0?bxGetUrlParam("cmd")=="close"?bxCloseOpenWindow():window.location=t.returnURL:n.showMessage({message:r},box)}),!1}),!n.isMobile&&t.wxOpenAppId&&bxSys.loadJsFile("//res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js"),t.way=="mobile"?this.showMobileLogin():t.way=="weixin"&&(bxNavigator.weixin&&$(".divForm_row").hide(),$(".aBtnLoginWeixin").click()),this.initApp()},showMobileLogin:function(){t.loginType="mobile",$(".divForm_row_normal").hide(),$(".divForm_row_mobile").show()},initApp:function(){window.apiready=function(){t.wxOpenAppAppId.length>0&&(t.isApp=!0,$(".divQuckLogin").show(),$(".aBtnLoginWeixin").unbind("click").click(function(){var i=api.require("wx");return i.auth({},function(i,r){var f,u;i.status?(f=i.code,n.showWaiting({title:"努力登录中..."}),u=window.location.protocol+"//"+window.location.host+"/html/memberpassport1.html",u=bxPub.replaceUrlParam("code",f,u),u=bxPub.replaceUrlParam("wxtype","app",u),u+="&ReturnURL="+encodeURIComponent(t.returnURL),window.location.href=u):alert(r.code)}),!1}))}}}}(),userRegister:function(){var t={quickLogin:!0,wxOpenAppId:"",wxOpenAppAppId:"",wxMpAppId:"",returnURL:"",authId:"",coder:null,allowType:2,registerType:bxGetUrlParam("rtype",""),isApp:!1};return{init:function(i){var r=this;bxPub.extend(t,i),t.allowType==2?t.registerType="mobile":t.allowType==4?t.registerType="email":t.registerType==""&&(t.registerType=n.getLang()=="en"?"email":"mobile"),$("#aBtnRegToEmail").add("#aBtnRegToMobile").hide(),bxNavigator.weixin||t.wxMpAppId?t.quickLogin=t.wxMpAppId&&t.wxMpAppId.length>0:bxNavigator.mobile||(t.quickLogin=t.wxOpenAppId&&t.wxOpenAppId.length>0),t.quickLogin?$(".divQuckLogin").show():$(".divQuckLogin").hide(),t.returnURL=bxGetUrlParam("ReturnURL")!=""?bxGetUrlParam("ReturnURL"):"memberindex.html",$(".aBtnLoginWeixin").click(function(){var i=window.location.protocol+"//"+window.location.host+"/html/memberpassport1.html?ReturnURL="+encodeURIComponent(t.returnURL),r;return n.isMobile?(r=bxWaiting(),n.createRedirectUrl({urlHead:n.global.wxMpUrlHead||"http://api.chinarun.com",url:i,callback:function(i){var r="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+(t.wxMpAppId||n.global.wxMpAppId)+"&redirect_uri="+encodeURIComponent(i.url)+"&response_type=code&scope=snsapi_userinfo#wechat_redirect";window.location.href=r}})):t.wxOpenAppId?n.wxQR({isWxOpenAppId:!0,appId:t.wxOpenAppId||n.global.wxOpenAppId,popup:!0,redirect_uri:bxPub.replaceUrlParam(i,"wxtype","open")}):n.wxQR({popup:!0,appId:t.wxMpAppId||n.global.wxMpAppId,success:function(n){window.location.href=bxPub.replaceUrlParam("code",n.authCode,i)}}),!1}),!n.isMobile&&t.wxOpenAppId&&bxSys.loadJsFile("//res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js"),$("#aBtnRegLogin").attr("href","memberlogin.html"+window.location.search),$("#aBtnRegGetPsw").attr("href","membergetpsw.html"+window.location.search),t.registerType=="email"?r.initEmail():(r.initMobile(),this.initApp())},initMobile:function(){var r=this,i;$(".divForm_row_email").remove(),n.createVerifyCode({btn:$("#aGetMobileCode"),input:$("#txtRegMobile"),inputType:"mobile",type:"register",name:"register"}),t.coder=n.createImgVerifyCode(bxPub.extend({container:"#spVcode"},bxPub.getJson($("#spVcode").p("option","{}")))),i=$("#aBtnRegister"),i.click(function(){if(!bxVal("reg"))return!1;var i=n.showWaiting(),r={mobile:$("#txtRegMobile").val(),psw:$("#txtRegPsw").val(),smscode:$("#txtRegMobileCode").val(),code:$("#txtRegVcode").val(),type:"mobile"};return n.userPageAPI("userregister",r,function(r,u,f){if(i.close(),r==0){var e=f.get("status");e=="logined"?n.showMessage({message:{cn:"恭喜您注册成功!",en:"Registration success"},onClosed:function(){if(window==window.top){var n=bxGetUrlParam("ReturnURL");n!=""?window.location.href=n:window.top.location.href="memberindex.html"}else bxCloseOpenWindow()}}):e=="toactived"?window.top.location.href="memberactive.html?email="+txtEmail.value.trim():n.showMessage({message:{cn:"恭喜您注册成功！将转到登录页面",en:"Congratulations on your success in registration"},onClosed:function(){window.top.location="memberlogin.html"}})}else n.showMessage({message:u}),t.coder.change()}),!1}),i.parents(".divForm").find(".txt").keyup(function(){bxSys.getKey().code==13&&i.click()}),(t.allowType==1||t.allowType==8)&&$("#aBtnRegToEmail").show().click(function(){return window.location.href=bxPub.replaceUrlParam("rtype","email"),!1})},initEmail:function(){var r=this,i;$(".divForm_row_mobile").remove(),n.createVerifyCode({btn:$("#aGetEmailCode"),input:$("#txtRegEmail"),inputType:"email",type:"register",name:"register"}),t.coder=n.createImgVerifyCode(bxPub.extend({container:"#spVcode"},bxPub.getJson($("#spVcode").p("option","{}")))),i=$("#aBtnRegister"),i.click(function(){if(!bxVal("reg"))return!1;var i=n.showWaiting({window:top}),r={email:$("#txtRegEmail").val(),psw:$("#txtRegPsw").val(),emailcode:$("#txtRegEmailCode").val(),code:$("#txtRegVcode").val(),type:"email"};return n.userPageAPI("userregister",r,function(r,u,f){if(i.close(),r==0){var e=f.get("status");e=="logined"?n.showMessage({message:{cn:"恭喜您注册成功!",en:"Registration success"},onClosed:function(){if(window==window.top){var n=bxGetUrlParam("ReturnURL");n!=""?window.location.href=n:window.top.location.href="memberindex.html"}else bxCloseOpenWindow()}}):e=="toactived"?window.top.location.href="memberactive.html?email="+txtEmail.value.trim():n.showMessage({message:"恭喜您注册成功！将转到登录页面",onClosed:function(){window.top.location="memberlogin.html"}})}else n.showMessage({message:u}),t.coder.change()}),!1}),i.parents(".divForm").find(".txt").keyup(function(){bxSys.getKey().code==13&&i.click()}),(t.allowType==1||t.allowType==8)&&$("#aBtnRegToMobile").show().click(function(){return window.location.href=bxPub.replaceUrlParam("rtype","mobile"),!1})},initApp:function(){window.apiready=function(){t.wxOpenAppAppId.length>0&&(t.isApp=!0,$(".divQuckLogin").show(),$(".aBtnLoginWeixin").unbind("click").click(function(){var i=api.require("wx");return i.auth({},function(i,r){var f,u;i.status?(f=i.code,n.showWaiting({title:"努力登录中..."}),u=window.location.protocol+"//"+window.location.host+"/html/memberpassport1.html",u=bxPub.replaceUrlParam("code",f,u),u=bxPub.replaceUrlParam("wxtype","app",u),u+="&ReturnURL="+encodeURIComponent(t.returnURL),window.location.href=u):alert(r.code)}),!1}))}}}}(),userPassport:function(){var t={tokenId:"",url:"",box:null,coder:null};return{init:function(){var r=this,i=bxPub.getUrlParam("ReturnURL");i.length>0?t.url=decodeURIComponent(i):(i=bxPub.sessionStorageGetItem("ReturnURL"),t.url=i&&i.length>0?i:"memberindex.html"),this.getAccess_token(),$("#aBtnBindSubmit").click(function(){return r.bindMember(),!1}),$("#txtLoginName").attr("placeholder",n.getWords({cn:"用户名/手机/邮箱",en:"name/mobile/email"}))},getAccess_token:function(){var i=this;n.pageAPI("","passportGetAccessToken",{},function(r,u,f){var e,o;r==0&&f.get("status")=="bind"||!t.box||(t.box.close(),t.box=null),r==0?(e=f.get("status"),e=="logined"?window==window.top?window.location.replace(t.url):bxCloseOpenWindow():e=="bind"?(t.tokenId=f.get("tokenid"),o=!1,$(".divConfirmBind").show(),n.isMobile||$(".divForm_caption").show(),$(".divLoading").hide(),$(".aBtnNotBind").click(function(){return i.createMember(),!1}),$(".aBtnBind").click(function(){return $(".divForm_row").show(),$(".divLoading").add(".divConfirmBind").hide(),t.coder=n.createImgVerifyCode(bxPub.extend({container:"#spVcode"},bxPub.getJson($("#spVcode").p("option","{}")))),!1})):e=="modifybindsuccess"?window.location.replace("memberaccountset.html"):e=="membertoken"?window.location.replace(bxPub.replaceUrlParam("token",f.get("token"),t.url)):e=="close"&&bxPub.closeWindow()):r==2?i.redirectToLogin():r==3?i.redirectToLogin():n.showMessage({message:u,onClosed:function(){window.location.replace(t.url)}})})},redirectToLogin:function(){var n="memberlogin.html",t=bxGetUrlParam("ReturnURL");t!=""&&(n+="?ReturnURL="+encodeURIComponent(t)),window.location.replace(n)},createMember:function(){$(".divConfirmBind").add(".divForm_caption").hide(),$(".divLoading").show(),n.pageAPI("","passportCreateMember",{tokenid:t.tokenId},function(i,r){i==0?window==window.top?window.location.replace(t.url):bxCloseOpenWindow():n.showMessage({message:"登录失败<br />"+r})})},bindMember:function(){if(!bxVal("login"))return!1;var r={tokenid:t.tokenId,name:$("#txtLoginName").valText(),password:$("#txtLoginPsw").valText(),vcode:$("#txtLoginVcode").valText()},i=bxWaiting();n.pageAPI("","passportBindMember",r,function(r,u){r==0?n.showMessage({message:n.getWords({cn:"绑定账号成功",en:"success"}),onClosed:function(){window==window.top?window.location.replace(t.url):bxCloseOpenWindow()}},i):(t.coder.change(),n.showMessage({message:n.getWords({cn:"绑定失败<br />"+u,en:"failure"})},i))})}}}(),userGetPsw:function(){var t={step:"name",loading:!1,uid:0,coder:null,verifyStatus:"",box:null,resetToken:""};return{init:function(){var i=this;t.coder=n.createImgVerifyCode(bxPub.extend({container:"#spVcode"},bxPub.getJson($("#spVcode").p("option","{}")))),n.createVerifyCode({btn:$("#aSmsCode"),input:"#txtGetMobile",name:"getpsw",type:"getpsw",onpreshow:function(){return t.verifyStatus=="checking"?(t.box=n.showWaiting({onClosed:function(){t.box=null}}),!1):t.verifyStatus=="success"?!0:t.verifyStatus=="failure"?(n.showMessage({message:n.getWords({cn:"手机号码验证失败",en:"Mobile number verification failed"})}),!1):(n.showMessage({message:n.getWords({cn:"请先验证手机号码",en:"Please verify your phone number first"})}),!1)}}),n.createVerifyCode({btn:$("#aEmailCode"),input:"#txtGetEmail",name:"getpsw",type:"getpsw",onpreshow:function(){return t.verifyStatus=="checking"?(t.box=n.showWaiting({onClosed:function(){t.box=null}}),!1):t.verifyStatus=="success"?!0:t.verifyStatus=="failure"?(n.showMessage({message:n.getWords({cn:"邮箱地址验证失败",en:"Email verification failed"})}),!1):(n.showMessage({message:n.getWords({cn:"请先验证邮箱地址",en:"Please verify your email first"})}),!1)}}),$("#aBtnGetPswNext").click(function(){return t.loading?!1:(t.step=="name"?i.getUserInfo():t.step=="vcode"?i.sendVcode():t.step=="psw"&&i.submitPsw(),!1)}),$(".divForm_getpsw .txt").keyup(function(){bxSys.getKey().code==13&&$("#aBtnGetPswNext").click()}),$("[name=gettype]").click(function(){this.value=="mobile"?($(".divForm_row_mobile").show(),$(".divForm_row_email").hide(),$("#txtGetMobile").focus()):this.value=="email"?($(".divForm_row_email").show(),$(".divForm_row_mobile").hide(),$("#txtGetEmail").focus()):($(".divForm_row_mobile").hide(),$(".divForm_row_email").hide())}),$("#txtGetMobile").focus(function(){t.verifyStatus=""})},getUserInfo:function(){var u=bxVal("get1"),f=bxVal("get"),r,i;if(!u||!f)return!1;r={method:"verifyname",name:$("#txtGetName").val().trim(),vcode:$("#txtGetVcode").val().trim()},t.loading=!0,$(".divRadGetType").hide(),i=n.showWaiting(),n.userPageAPI("getpsw",r,function(r,u,f){if(t.loading=!1,t.coder.change(),$("#txtGetVcode").val(""),r==0){i.close(),t.step="vcode",$(".step1").hide(),$(".divForm_row_vtype").show(),t.uid=f.getInt("uid");var e=f.get("mobile"),o=f.get("email");e.length>0?($("#spMobile").html(" ("+e+")"),$(".divRadGetType_mobile").show(),o==""&&$("#radGetType_mobile").click()):$("#spMobile").html(""),o.length>0?($("#spEmail").html(" ("+o+")"),$(".divRadGetType_email").show(),e==""&&$("#radGetType_email").click()):$("#spEmail").html(""),$("#aSmsCode").add("#aEmailCode").attr("disabled","disabled")}else n.showMessage({message:u},i),t.uid=0})},onMobileChange:function(){var i=$("#spValGetMobile").p("val"),r;i.setWaiting(),$("#txtGetMobile")[0].disabled=!0,t.verifyStatus="checking",r={uid:t.uid,method:"verifymobile",mobile:$("#txtGetMobile").val().trim()},n.userPageAPI("getpsw",r,function(r,u,f){$("#txtGetMobile")[0].disabled=!1,r==0?f.getBool("match")?(i.setMessage(!0),t.verifyStatus="success",t.box&&(t.box.close(),t.box=null,$("#aSmsCode").click())):(i.setMessage(!1),t.verifyStatus="failure",n.showMessage({message:n.getWords({cn:"手机号码不匹配",en:"Phone number does not match"})},t.box)):(t.verifyStatus="failure",n.showMessage({message:u},t.box))})},onEmailChange:function(){var i=$("#spValGetEmail").p("val"),r;i.setWaiting(),$("#txtGetEmail")[0].disabled=!0,t.verifyStatus="checking",r={uid:t.uid,method:"verifyemail",email:$("#txtGetEmail").val().trim()},n.userPageAPI("getpsw",r,function(r,u,f){$("#txtGetEmail")[0].disabled=!1,r==0?f.getBool("match")?(i.setMessage(!0),t.verifyStatus="success",t.box&&(t.box.close(),t.box=null,$("#aEmailCode").click())):(i.setMessage(!1),t.verifyStatus="failure",n.showMessage({message:n.getWords({cn:"邮箱地址不匹配",en:"Email does not match"})},t.box)):(t.verifyStatus="failure",n.showMessage({message:u},t.box))})},sendVcode:function(){var e=bxRadioGetValue("gettype",""),r,u,f,i;if(e==""){n.showMessage({message:n.getWords({cn:"请选择验证方式",en:"Please select the verification method"})});return}if(e=="mobile"){if(r=bxVal("get_mobile"),u=bxVal("get"),!r||!u)return;f={method:"verifysmscode",uid:t.uid,vcode:$("#txtGetVcode").val().trim(),smscode:$("#txtSmsCode").val().trim()},i=n.showWaiting(),n.userPageAPI("getpsw",f,function(r,u,f){$("#txtGetVcode").val(""),t.coder.change(),r==0?(t.resetToken=f.get("token"),i.close(),$(".divForm_row_psw").show(),$(".divForm_row_mobile").hide(),$(".divForm_row_vtype").hide(),$("#txtRegPsw").focus(),t.step="psw"):(n.showMessage({message:u},i),bxVal("get"))})}else if(e=="email"){if(r=bxVal("get_email"),u=bxVal("get"),!r||!u)return;f={method:"verifyemailcode",uid:t.uid,vcode:$("#txtGetVcode").val().trim(),emailcode:$("#txtEmailCode").val().trim()},i=n.showWaiting(),n.userPageAPI("getpsw",f,function(r,u,f){$("#txtGetVcode").val(""),t.coder.change(),r==0?(t.resetToken=f.get("token"),i.close(),$(".divForm_row_psw").show(),$(".divForm_row_email").hide(),$(".divForm_row_vtype").hide(),$("#txtRegPsw").focus(),t.step="psw"):(n.showMessage({message:u},i),bxVal("get"))})}},submitPsw:function(){var u=bxVal("get_psw"),f=bxVal("get"),r,i;u&&f&&(r={method:"setpsw",uid:t.uid,vcode:$("#txtGetVcode").val().trim(),token:t.resetToken,psw:$("#txtRegPsw").val().trim()},i=n.showWaiting(),n.userPageAPI("getpsw",r,function(r,u){t.coder.change(),r==0?n.showMessage({message:n.getWords({cn:"密码重置成功",en:"Reset successfully!"}),onClosed:function(){window.location.href="memberlogin.html"+window.location.search}},i):(n.showMessage({message:u},i),$("#txtGetVcode").val(""),bxVal("get"))}))}}}(),userResetPsw:function(){return{init:function(){$("#aBtnPswSubmit").click(function(){if(!bxVal("psw"))return!1;var t=n.showWaiting({title:"正在提交您的修改信息，请稍后",message:"正在提交您的修改信息，请稍后...",window:top}),i={psw:$("#txtPswNew").val(),email:bxGetUrlParam("email"),guid:bxGetUrlParam("guid")};return n.userPageAPI("resetpassword",i,function(i,r){i==0?n.showMessage({message:"<br /><br />修改成功<br /><br />",onClosed:function(){t.close(),window.location.href="memberlogin.html"}},t):n.showMessage({message:"<br /><br />"+r+"<br /><br />"},t)}),!1})}}}(),userModifyPsw:function(){var t={coder:null,token:bxGetUrlParam("token")};return{init:function(){var i=this;webPages.site.userCenter.init({loaded:function(){if(t.token==""){window.location.href="memberval.html?ReturnURL="+encodeURIComponent(window.location.href);return}t.coder=n.createImgVerifyCode(bxPub.extend({container:"#spVcode"},bxPub.getJson($("#spVcode").p("option","{}")))),$("#aBtnPswSubmit").click(function(){if(!bxVal("psw"))return!1;var i=n.showWaiting({message:n.getWords({cn:"正在提交您的修改信息，请稍后...",en:""}),window:top}),r={token:t.token,psw:$("#txtPswNew").val(),vcode:$("#txtPswVcode").val().trim()};return n.userPageAPI("modifypsw",r,function(r,u){t.coder.change(),r==0?n.showMessage({message:"<br /><br />"+n.getWords("修改成功","Successfully modified")+"<br /><br />",onClosed:function(){i.close(),window.location.replace(window.location.href)}},i):r==2?n.showMessage({message:u,onClosed:function(){window.location.href="membermodifypsw.html"}},i):r==3?n.showMessage({message:u,onClosed:function(){window.location.href="membermodifypsw.html"}},i):n.showMessage({message:n.getWords(u,"Successfully fails")},i)}),!1}),$(".divForm .txt").keyup(function(){bxSys.getKey().code==13&&$("#aBtnPswSubmit").click()})}})}}}(),userAccountSetting:function(){var t={coder:null,step:bxGetUrlParam("step"),token:bxGetUrlParam("token"),wxOpenAppId:"",wxMpAppId:""};return{init:function(i){var r=this;bxPub.extend(t,i),webPages.site.userCenter.init({loaded:function(){t.coder=n.createImgVerifyCode(bxPub.extend({container:"#spVcode"},bxPub.getJson($("#spVcode").p("option","{}")))),r.getBindList(),$("#aBtnPswSubmit").click(function(){if(!bxVal("psw"))return!1;var i=n.showWaiting({message:n.getWords({cn:"正在提交您的修改信息，请稍后...",en:""}),window:top}),r={token:t.token,psw:$("#txtPswNew").val(),vcode:$("#txtPswVcode").val().trim()};return n.userPageAPI("modifypsw",r,function(r,u){t.coder.change(),r==0?n.showMessage({message:"<br /><br />"+n.getWords("修改成功","Successfully modified")+"<br /><br />",onClosed:function(){i.close(),window.location.replace(window.location.href)}},i):r==2?n.showMessage({message:u,onClosed:function(){window.location.href="membermodifypsw.html"}},i):r==3?n.showMessage({message:u,onClosed:function(){window.location.href="membermodifypsw.html"}},i):n.showMessage({message:n.getWords(u,"Successfully fails")},i)}),!1})}}),$("#aBtnSetname").click(function(){return t.step="name",$(".divForm_row").hide(),$(".divForm_row_set_name").add(".divForm_row_vcode").add(".divForm_row_btns").show(),!1}),$("#aBtnBindMobile").click(function(){return t.step="mobile",$(".divForm_row").hide(),$(".divForm_row_set_mobile").add(".divForm_row_vcode").add(".divForm_row_btns").show(),n.createVerifyCode({inputType:"mobile",btn:"#aGetMobileCode",input:"#txtSetMobile",name:"accountset",type:"accountset"}),!1}),$("#aBtnSubmit").click(function(){return t.step=="name"?r.submitName():t.step=="mobile"?r.submitMobile():t.step=="email"&&r.submitEmail(),!1}),$("#txtSetMobile").change(function(){$("#txtSetMobileCode").val("")}),$("#aBtnModifyMobile").click(function(){return t.token==""?window.location.href="memberval.html?valtype=mobile&ReturnURL="+encodeURIComponent(bxPub.replaceUrlParam("step","modifymobile")):(t.step="mobile",$(".divForm_row").hide(),$(".divForm_row_set_mobile").add(".divForm_row_vcode").add(".divForm_row_btns").show(),n.createVerifyCode({inputType:"mobile",btn:"#aGetMobileCode",input:"#txtSetMobile",name:"accountset",type:"accountset"})),!1}),$("#aBtnCancelMobile").click(function(){return t.token==""?n.confirm({message:n.getWords({cn:"您确定要解绑吗？",en:"Are you sure you want to delete it?"}),callBackOk:function(){window.location.href="memberval.html?valtype=mobile&ReturnURL="+encodeURIComponent(bxPub.replaceUrlParam("step","cancelmobile"))}}):r.cancelMobile(),!1}),$("#txtSetEmail").change(function(){$("#txtSetEmailCode").val("")}),$("#aBtnBindEmail").click(function(){return t.step="email",$(".divForm_row").hide(),$(".divForm_row_set_email").add(".divForm_row_vcode").add(".divForm_row_btns").show(),n.createVerifyCode({inputType:"email",btn:"#aGetEmailCode",input:"#txtSetEmail",name:"accountset",type:"accountset"}),!1}),$("#aBtnModifyEmail").click(function(){return t.token==""?window.location.href="memberval.html?valtype=email&ReturnURL="+encodeURIComponent(bxPub.replaceUrlParam("step","modifyemail")):(t.step="email",$(".divForm_row").hide(),$(".divForm_row_set_email").add(".divForm_row_vcode").add(".divForm_row_btns").show(),n.createVerifyCode({inputType:"email",btn:"#aGetEmailCode",input:"#txtSetEmail",name:"accountset",type:"accountset"})),!1}),$("#aBtnCancelEmail").click(function(){return t.token==""?n.confirm({message:n.getWords({cn:"您确定要解绑吗？",en:"Are you sure you want to delete it?"}),callBackOk:function(){window.location.href="memberval.html?valtype=email&ReturnURL="+encodeURIComponent(bxPub.replaceUrlParam("step","cancelemail"))}}):r.cancelEmail(),!1}),$("#aBtnBindWeixin").click(function(){return t.step="weixin",$(".divForm_row").add(".divForm_row_weixin").hide(),$(".divForm_row_set_weixin").show(),n.wxQR({container:"#divWxLoginQRcode",appId:t.wxMpAppId||n.global.wxMpAppId,success:function(i){var r=n.showWaiting(),u={method:"modifyweixin",authid:i.authId,authcode:i.authCode,token:t.token};n.userPageAPI("accountsetting",u,function(i,u){t.coder.change(),i==0?n.showMessage({message:n.getWords({cn:"绑定成功",en:"successfully"}),onClosed:function(){window.location.href="membersetting.html"}},r):i==2?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},r):i==3?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},r):n.showMessage({message:u},r)})}}),!1}),$("#aBtnModifyWeixin").click(function(){return t.token==""?window.location.href="memberval.html?valtype=weixin&ReturnURL="+encodeURIComponent(bxPub.replaceUrlParam("step","modifyweixin")):$("#aBtnBindWeixin").click(),!1}),$("#aBtnCancelWeixin").click(function(){return t.token==""?n.confirm({message:n.getWords({cn:"您确定要解绑吗？",en:"Are you sure you want to delete it?"}),callBackOk:function(){window.location.href="memberval.html?valtype=weixin&ReturnURL="+encodeURIComponent(bxPub.replaceUrlParam("step","cancelweixin"))}}):r.cancelWeixin(),!1})},getBindList:function(){n.userPageAPI("accountsetting",{method:"getbindlist"},function(i,r,u){var f,e,o,s;i==0?($(".divForm_row_loading").hide(),$(".divForm_row_mobile").add(".divForm_row_email").show(),f=u.get("name"),f==""?$(".divForm_row_name_set").show():($(".divForm_row_name").show(),$("#spSetName").html(f)),e=u.get("mobile"),e==""?($("#aBtnModifyMobile").add("#aBtnCancelMobile").hide(),$("#spSetMobile").html(bxPub.getLangWord({cn:"尚未绑定",en:"Not bound"}))):($("#spSetMobile").html(e),$("#aBtnBindMobile").hide()),o=u.get("email"),o==""?($("#aBtnModifyEmail").add("#aBtnCancelEmail").hide(),$("#spSetEmail").html(bxPub.getLangWord({cn:"尚未绑定",en:"Not bound"}))):($("#spSetEmail").html(o),$("#aBtnBindEmail").hide()),t.step=="modifyemail"?$("#aBtnModifyEmail").click():t.step=="cancelemail"&&$("#aBtnCancelEmail").click(),(t.wxMpAppId.length>0||t.wxOpenAppId.length>0)&&(s=u.get("weixin"),$(".divForm_row_weixin").show(),s==""?($("#aBtnModifyWeixin").add("#aBtnCancelWeixin").hide(),$("#spSetWeixin").html(bxPub.getLangWord({cn:"尚未绑定",en:"Not bound"}))):($("#spSetWeixin").html(s),$("#aBtnBindWeixin").hide())),t.step=="modifymobile"?$("#aBtnModifyMobile").click():t.step=="cancelmobile"?$("#aBtnCancelMobile").click():t.step=="modifyweixin"?$("#aBtnModifyWeixin").click():t.step=="cancelweixin"&&$("#aBtnCancelWeixin").click()):n.showMessage({message:r})})},submitName:function(){var u=bxVal("name"),f=bxVal("set"),r,i;if(!u||!f)return!1;r={method:"updatename",name:$("#txtSetName").val().trim(),vcode:$("#txtSetVcode").val().trim()},i=n.showWaiting(),n.userPageAPI("accountsetting",r,function(r,u){t.coder.change(),r==0?n.showMessage({message:n.getWords({cn:"设置成功",en:"successfully"}),onClosed:function(){window.location.href="membersetting.html"}},i):n.showMessage({message:u},i)})},submitMobile:function(){var u=bxVal("mobile"),f=bxVal("set"),r,i;if(!u||!f)return!1;r={method:"updatemobile",mobile:$("#txtSetMobile").val().trim(),vcode:$("#txtSetVcode").val().trim(),smscode:$("#txtSetMobileCode").val().trim(),token:t.token},i=n.showWaiting(),n.userPageAPI("accountsetting",r,function(r,u){t.coder.change(),r==0?n.showMessage({message:n.getWords({cn:"设置成功",en:"successfully"}),onClosed:function(){window.location.href="membersetting.html"}},i):r==2?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},i):r==3?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},i):n.showMessage({message:u},i)})},cancelMobile:function(){var i=n.showWaiting(),r={method:"cancelmobile",token:t.token};n.userPageAPI("accountsetting",r,function(r,u){t.coder.change(),r==0?n.showMessage({message:n.getWords({cn:"解绑成功",en:"successfully"}),onClosed:function(){window.location.href="membersetting.html"}},i):r==2?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},i):r==3?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},i):n.showMessage({message:u},i)})},submitEmail:function(){var u=bxVal("email"),f=bxVal("set"),r,i;if(!u||!f)return!1;r={method:"updateemail",email:$("#txtSetEmail").val().trim(),vcode:$("#txtSetVcode").val().trim(),emailcode:$("#txtSetEmailCode").val().trim(),token:t.token},i=n.showWaiting(),n.userPageAPI("accountsetting",r,function(r,u){t.coder.change(),r==0?n.showMessage({message:n.getWords({cn:"设置成功",en:"successfully"}),onClosed:function(){window.location.href="membersetting.html"}},i):r==2?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},i):r==3?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},i):n.showMessage({message:u},i)})},cancelEmail:function(){var i=n.showWaiting(),r={method:"cancelemail",token:t.token};n.userPageAPI("accountsetting",r,function(r,u){t.coder.change(),r==0?n.showMessage({message:n.getWords({cn:"解绑成功",en:"successfully"}),onClosed:function(){window.location.href="membersetting.html"}},i):r==2?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},i):r==3?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},i):n.showMessage({message:u},i)})},cancelWeixin:function(){var i=n.showWaiting(),r={method:"cancelweixin",token:t.token};n.userPageAPI("accountsetting",r,function(r,u){t.coder.change(),r==0?n.showMessage({message:n.getWords({cn:"解绑成功",en:"successfully"}),onClosed:function(){window.location.href="membersetting.html"}},i):r==2?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},i):r==3?n.showMessage({message:u,onClosed:function(){window.location.href="membersetting.html"}},i):n.showMessage({message:u},i)})}}}(),userVal:function(){var t={wxOpenAppId:"",wxMpAppId:"",returnURL:bxGetUrlParam("ReturnURL"),coder:null,step:"type",verifyStatus:"",box:null,valType:bxGetUrlParam("valtype"),isWxOpen:!1,authId:""};return{init:function(i){var r=this;bxPub.extend(t,i),!n.isMobile&&t.wxOpenAppId.length>0&&(t.isWxOpen=!0),webPages.site.userCenter.init({loaded:function(){t.coder=n.createImgVerifyCode(bxPub.extend({container:"#spVcode"},bxPub.getJson($("#spVcode").p("option","{}")))),$(".divForm_row_loading").show(),$("#aBtnValNext").click(function(){if(t.step=="psw")r.submitPsw();else if(t.step=="mobile")r.submitMobile();else if(t.step=="email")r.submitEmail();else{var i=bxRadioGetValue("gettype","");if(i=="")return n.showMessage({message:n.getWords({cn:"请选择验证方式",en:"please select"})}),!1;$(".divForm_row_vtype").hide(),i=="psw"?r.showPsw():i=="weixin"?r.showWeixin():i=="mobile"?r.showMobile():i=="email"&&r.showEmail()}return!1}),r.getTypeList(),t.wxOpenAppId.length>0&&!n.isMobile&&bxSys.loadJsFile("http://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js")}})},getTypeList:function(){n.userPageAPI("valaccount",{method:"gettypelist"},function(i,r,u){if(i==0){$(".divForm_row_loading").hide(),$(".divForm_row_vtype").add(".divForm_row_btns").show();var f=u.get("mobile");f==""?$(".divRadGetType_mobile").hide():($("#spMobile").html("("+f+")"),$("#spValMobileCurrent").html(f)),f=u.get("email"),f==""?$(".divRadGetType_email").hide():($("#spEmail").html("("+f+")"),$("#spValEmailCurrent").html(f)),f=u.get("weixin"),f==""?$(".divRadGetType_weixin").hide():$("#spWeixin").html("("+f+")"),u.getBool("password")||$(".divRadGetType_psw").hide(),t.valType!=""&&(bxRadioSetValue("gettype",t.valType),$("#aBtnValNext").click())}else n.showMessage({message:r})})},showWeixin:function(){var i,r;t.step="weixin",$(".divForm_row_qrcode").show(),$(".divForm_row_btns").hide(),i=window.location.protocol+"//"+window.location.host+"/html/memberpassport1.html?cmd=getmembertoken&ReturnURL="+encodeURIComponent(t.returnURL),t.isWxOpen&&(i=bxPub.replaceUrlParam("wxtype","open")),$("#divQRRemark").html("<span>请使用微信<\/span> <span class='b'>"+$("#spWeixin").html()+"<\/span> <span>扫一扫以下二维码<\/span>"),n.isMobile?(r=bxWaiting(),n.createRedirectUrl({urlHead:n.global.wxMpUrlHead||"http://api.chinarun.com",url:i,callback:function(i){var r="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+(t.wxMpAppId||n.global.wxMpAppId)+"&redirect_uri="+encodeURIComponent(i.url)+"&response_type=code&scope=snsapi_userinfo#wechat_redirect";window.location.href=r}})):t.isWxOpen?($("#divWxLoginQRcode").addClass("divWxLoginQRcode_open"),n.wxQR({container:"#divWxLoginQRcode",isWxOpenAppId:!0,appId:t.wxOpenAppId||n.global.wxOpenAppId,redirect_uri:bxPub.replaceUrlParam(i,"wxtype","open")})):n.wxQR({container:"#divWxLoginQRcode",appId:t.wxMpAppId||n.global.wxMpAppId,success:function(n){window.location.href=bxPub.replaceUrlParam("code",n.authCode,i)}})},showPsw:function(){t.step="psw",$(".divForm_row_psw").add(".divForm_row_vcode").show()},submitPsw:function(){var u=bxVal("psw"),f=bxVal("vcode"),i,r;if(!u||!f)return!1;i={method:"psw",psw:$("#txtPswOld").val().trim(),vcode:$("#txtVcode").val().trim()},r=n.showWaiting(),n.userPageAPI("valaccount",i,function(i,u,f){if(i==0){var e=f.get("token");window.location.href=bxPub.replaceUrlParam("token",e,t.returnURL)}else n.showMessage({message:u},r)})},showMobile:function(){t.step="mobile",$(".divForm_row_mobile").add(".divForm_row_vcode").show(),n.createVerifyCode({btn:$("#aSmsCode"),input:"#txtValMobile",name:"valmobile",type:"valmobile",onpreshow:function(){return t.verifyStatus=="checking"?(t.box=n.showWaiting({onClosed:function(){t.box=null}}),!1):t.verifyStatus=="success"?!0:t.verifyStatus=="failure"?(n.showMessage({message:n.getWords({cn:"手机号码验证失败",en:"Mobile number verification failed"})}),!1):(n.showMessage({message:n.getWords({cn:"请先验证手机号码",en:"Please verify your phone number first"})}),!1)}})},submitMobile:function(){var u=bxVal("val_mobile"),f=bxVal("vcode"),i,r;if(!u||!f)return!1;i={method:"mobile",mobile:$("#txtValMobile").val().trim(),smscode:$("#txtSmsCode").val().trim(),vcode:$("#txtVcode").val().trim()},r=n.showWaiting(),n.userPageAPI("valaccount",i,function(i,u,f){if(i==0){var e=f.get("token");window.location.href=bxPub.replaceUrlParam("token",e,t.returnURL)}else n.showMessage({message:u},r)})},onMobileChange:function(){var i=$("#spValGetMobile").p("val"),r;i.setWaiting(),$("#txtValMobile")[0].disabled=!0,t.verifyStatus="checking",r={method:"verifymobile",mobile:$("#txtValMobile").val().trim()},n.userPageAPI("valaccount",r,function(r,u,f){$("#txtValMobile")[0].disabled=!1,r==0?f.getBool("match")?(i.setMessage(!0),t.verifyStatus="success",t.box&&(t.box.close(),t.box=null,$("#aSmsCode").click())):(i.setMessage(!1),t.verifyStatus="failure",n.showMessage({message:n.getWords({cn:"手机号码不匹配",en:"Phone number does not match"})},t.box)):(t.verifyStatus="failure",n.showMessage({message:u},t.box))})},showEmail:function(){t.step="email",$(".divForm_row_email").add(".divForm_row_vcode").show(),n.createVerifyCode({btn:$("#aEmailCode"),input:"#txtValEmail",name:"valemail",type:"valemail",onpreshow:function(){return t.verifyStatus=="checking"?(t.box=n.showWaiting({onClosed:function(){t.box=null}}),!1):t.verifyStatus=="success"?!0:t.verifyStatus=="failure"?(n.showMessage({message:n.getWords({cn:"邮箱地址验证失败",en:"Email verification failed"})}),!1):(n.showMessage({message:n.getWords({cn:"请先验证邮箱地址",en:"Please verify your email first"})}),!1)}})},submitEmail:function(){var u=bxVal("val_email"),f=bxVal("vcode"),i,r;if(!u||!f)return!1;i={method:"email",email:$("#txtValEmail").val().trim(),emailcode:$("#txtEmailCode").val().trim(),vcode:$("#txtVcode").val().trim()},r=n.showWaiting(),n.userPageAPI("valaccount",i,function(i,u,f){if(i==0){var e=f.get("token");window.location.href=bxPub.replaceUrlParam("token",e,t.returnURL)}else n.showMessage({message:u},r)})},onEmailChange:function(){var i=$("#spValGetEmail").p("val"),r;i.setWaiting(),$("#txtValEmail")[0].disabled=!0,t.verifyStatus="checking",r={method:"verifyemail",email:$("#txtValEmail").val().trim()},n.userPageAPI("valaccount",r,function(r,u,f){$("#txtValEmail")[0].disabled=!1,r==0?f.getBool("match")?(i.setMessage(!0),t.verifyStatus="success",t.box&&(t.box.close(),t.box=null,$("#aEmailCode").click())):(i.setMessage(!1),t.verifyStatus="failure",n.showMessage({message:n.getWords({cn:"邮箱地址不匹配",en:"Phone number does not match"})},t.box)):(t.verifyStatus="failure",n.showMessage({message:u},t.box))})}}}(),userIndex:function(){return{init:function(){var n=this;webPages.site.userCenter.init({loaded:function(){n.getInfo()}})},getInfo:function(){var t=n.showWaiting();bxPageAPI("","getMemberIndexInfo",{},function(i,r,u){if(i==0){t.close();var f=u.get("head");$("#aHeadPhoto").html("<img src='"+f+"' class='imgHeadPhoto'/>").attr("href",u.get("head2")),$("#divUserInfo").html(u.get("userinfo")),$("#divAccountInfo").html(u.get("accountinfo"))}else n.showMessage({message:n.getWords({cn:r,en:"error"})},t)})}}}(),userInfoSet:function(){var t={area:null};return{init:function(){var n=this;webPages.site.userCenter.init({loaded:function(){bxPlugin.run("areaselect",function(){var i,r,n;for(t.area=bxAreaSelect.create({target:$("#spArea")[0]}),i=bxAreaSelect.getCountryList(),r=$("#selSetCountry")[0],n=0;n<i.length;n++)bxSelectAddOption(r,i[n][1],i[n][1])}),n.getInfo()}}),$("#aBtnSetSubmit").click(function(){return n.submit(),!1});$("#txtSetIDCard").on("blur change",function(){var n=this.value.trim();/\d{17}(\d|x)/ig.test(n)&&($("#txtSetBirthday").val(n.substr(6,4)+"-"+n.substr(10,2)+"-"+n.substr(12,2)),bxRadioSetValue("sex",bxPub.parseInt(n.substr(16,1),0)%2==0?"女":"男"))})},getInfo:function(){var i=n.showWaiting();bxPageAPI("","memberInfoSet",{method:"get"},function(r,u,f){if(i.close(),r==0){$("#txtSetFriendlyName").val(f.get("friendlyname")),$("#txtSetRealName").val(f.get("realname")),bxRadioSetValue("sex",f.get("sex")),$("#txtSetBirthday").val(f.get("birthday")),$("#txtSetIDCard").val(f.get("idcard")),$("#selSetCountry").val(f.get("country"));var e=f.getObject("city");t.area.setValue(e.province,e.city,e.xian),$("#txtSetAddress").val(f.get("address")),$("#txtSetIntro").val(f.get("introduce"))}else n.showMessage({message:n.getWords({cn:u,en:"error"})})})},submit:function(){if(!bxVal("set"))return!1;var r={method:"set",friendlyname:$("#txtSetFriendlyName").val().trim(),realname:$("#txtSetRealName").val().trim(),sex:bxRadioGetValue("sex",""),birthday:$("#txtSetBirthday").val().trim(),idcard:$("#txtSetIDCard").val().trim(),country:$("#selSetCountry").val().trim(),address:$("#txtSetAddress").val().trim(),introduce:$("#txtSetIntro").val().trim(),city:t.area.getValue()},i=n.showWaiting();bxPageAPI("","memberInfoSet",r,function(t,r){t==0?n.showMessage({message:n.getWords({cn:"设置成功",en:"Set up successfully"})},i):n.showMessage({message:n.getWords({cn:r,en:"error"})},i)})}}}(),userHeadPhoto:function(){var t={editor:null,url:"",urlView:""};return{init:function(){var i=this;webPages.site.userCenter.init({loaded:function(){i.initEdit()}}),$("#aBtnPhotoSubmit").click(function(){var r=bxPub.extend({method:"set",url:t.url},t.editor.getValue()),i=n.showWaiting();return bxPageAPI("","modifymemberheadphoto",r,function(t,r){t==0?n.showMessage({message:n.getWords({cn:"保存成功",en:"Save successfully"}),onClosed:function(){window.location.href="memberindex.html"}},i):n.showMessage({message:n.getWords({cn:r,en:"error"})},i)}),!1}),$(".aBtnUploadPhoto").click(function(){var n=gui().dialog.prompt({title:"上传照片",inputs:[{name:"file",text:{cn:"上传照片",en:"Picture"},type:"image",option:{},val:{mode:"rfv"}}],onOK:function(n){var i=n.data;t.url=i.file,t.urlView="/upload/thumb"+i.file.substr(0,i.file.lastIndexOf("."))+"_s_0_0_90."+i.file.substring(i.file.lastIndexOf(".")+1),$("#divHeadPhotoEditContainer").show(),$(".divForm_row_toolbar").show(),$(".divForm_row_submit").show(),t.editor.resetImg(),t.editor.resize()}});return!1})},initEdit:function(){var i=function(){return{init:function(){this.initMove(),this.initScale()},initMove:function(){var o=$("#divHeadPhotoEditContainer"),n=$(".divCut"),i=$(".imgPhoto"),r=$(".divActionMask"),u={x:0,y:0},f={x:0,y:0},e=!1;r.on("mousedown",function(){t.url!=""&&(u={x:i[0].offsetLeft,y:i[0].offsetTop},f=bxPub.getMousePosition(bxSys.getEvent()),r.addClass("divActionMask_move"),e=!0)});r.on("mousemove",function(){if(e){var t=bxPub.getMousePosition(bxSys.getEvent());i.css("left",Math.max(n[0].offsetLeft+n[0].offsetWidth-i[0].offsetWidth+1,Math.min(n[0].offsetLeft,u.x+t.x-f.x))+"px"),i.css("top",Math.max(n[0].offsetTop+n[0].offsetHeight-i[0].offsetHeight,Math.min(n[0].offsetTop,u.y+t.y-f.y))+"px")}});r.on("mouseup",function(){e=!1,r.removeClass("divActionMask_move")});bxPlugin.run("touch",function(){touch.on(r,"touchstart",function(n){u={x:i[0].offsetLeft,y:i[0].offsetTop},n.preventDefault()});touch.on(r,"drag",function(t){var r={x:t.x,y:t.y};i.css("left",Math.max(n[0].offsetLeft+n[0].offsetWidth-i[0].offsetWidth+1,Math.min(n[0].offsetLeft,u.x+r.x))+"px"),i.css("top",Math.max(n[0].offsetTop+n[0].offsetHeight-i[0].offsetHeight,Math.min(n[0].offsetTop,u.y+r.y))+"px"),t.preventDefault()})})},initScale:function(){var u=$("#divHeadPhotoEditContainer"),n=$(".divCut"),i=$(".imgPhoto"),f=$(".divActionMask"),r=function(t){var l=i[0].offsetLeft,a=i[0].offsetTop,o=i[0].offsetWidth,s=i[0].offsetHeight,f=n[0].offsetWidth,e=n[0].offsetHeight,v=(n[0].offsetLeft+f/2-l)*1/i[0].offsetWidth,y=(n[0].offsetTop+e/2-a)*1/i[0].offsetHeight,r=o*(1+t),u=s*(1+t),h,c;r>=u?u<e&&(r=o*e/s,u=e):r<f&&(r=f,u=s*f/o),h=l+(o-r)*v,c=a+(s-u)*y,h=Math.max(n[0].offsetLeft+f-r,Math.min(n[0].offsetLeft,h)),c=Math.max(n[0].offsetTop+e-u,Math.min(n[0].offsetTop,c)),i.css({left:h+"px",top:c+"px",width:r+"px"})};$(".aBtnBigger").click(function(){if(t.url!="")return r(.1),!1}),$(".aBtnSmaller").click(function(){if(t.url!="")return r(-.1),!1})},resetImg:function(){var i=$(".imgPhoto"),r=$("#divHeadPhotoEditContainer"),u=function(){i.css("width","");var u=i.width(),f=i.height(),n=r[0].clientWidth,t=r[0].clientHeight;u*1/f>n*1/t?i.css("width",n+"px"):i.css("width",u*t/f+"px"),i.css("left",(n-i.width())/2+"px"),i.css("top",(t-i.height())/2+"px")},f;i.attr("src","//cdn.chinarun.com"+t.urlView),i[0].complete?u():(f=n.showWaiting(),i[0].onload=function(){u(),f.close()})},resize:function(){var n=$("#divHeadPhotoEditContainer"),i=n[0].clientWidth,r=n[0].clientHeight,t=$(".divCut");$(".divCutMask2").add(".divCutMask3").css("width",t[0].offsetLeft+"px")},getValue:function(){var i=$("#divHeadPhotoEditContainer"),n=$(".divCut"),t=$(".imgPhoto"),r=$(".divActionMask");return{imgWidth:t[0].offsetWidth,imgHeight:t[0].offsetHeight,cutLeft:n[0].offsetLeft-t[0].offsetLeft,cutTop:n[0].offsetTop-t[0].offsetTop,cutWidth:n[0].offsetWidth,cutHeight:n[0].offsetHeight}}}}();t.editor=i,i.init()}}}(),userBmOrderList:function(){var t={pageIndex:1,status:"",str:"",data:[],isLoad:!0,isPage:!0,page:0,timer:null};return{init:function(n){bxPub.extend(t,n);var i=this;webPages.site.userCenter.init({loaded:function(){$(".aBtnListFinished").click()}}),$(".divTooBar a").click(function(){return $(this).addClass("selected").siblings(".aBtnLink").removeClass("selected"),t.status=$(this).p("v"),i.getBmList(1),!1})},getBmList:function(i){var r=$("#divMgvList");r.html("<div class='loading'><\/div>"),t.pageIndex=i||t.pageIndex,bxPageAPI("","getbmorderlist",{pageindex:t.pageIndex,status:t.status},function(t,i,u){t==0?(r.html(u.get("htmltext")),$(".divRecordItem").click(function(){window.open($(this).attr("href"))})):n.showMessage({message:i})})}}}(),userTeam:function(){return{init:function(){webPages.site.userCenter.init(function(){var t=$(".divMgvList");n.sitePageAPI("getmemberteamlist",{},function(i,r,u){var e,f;i==0?(e=u.getObject("list"),e.length==0?t.html("您还没有创建"+n.global.team.name):(f="<table class='bx_gv'><tr class='bx_gv_header'><th class='th1' style='width:120px;'>头像<\/th><th class='th2'>名字<\/th><th class='th3' style='width:130px'>类型<\/th><th class='th4' style='width:60px;'>已加人数<\/th><th class='th5' style='width:60px'>详情<\/th><\/tr>",e.each(function(t){f+="<tr class='bx_gv_row'><td><img src='{4}' class='imgLogo'/><\/a><\/td><td class='n'>{1}<\/td><td>{2}<\/td><td>{3}<\/td><td><a href='memberteamdetail.html?teamid={0}' class='aDetail'>查看详情<\/a><\/td><\/tr>".format(t.id,t.name,n.global.team.typeName[t.teamtype],t.added,t.logo.length>0?t.logo:bxConst.Transparent1PxGifBase64Src)}),f+="<\/table>",t.html(f))):t.html(r)})})}}}(),userTeamDetail:function(){return{init:function(){webPages.site.userCenter.init(function(){var t=$(".divMgvList");n.sitePageAPI("getmemberteamdetail",{teamid:bxGetUrlParam("teamid")},function(n,i,r){if(n==0){var e=r.getObject("detail"),u="<ul class='ulDetail'><li><span class='t'>ID：<\/span>{id}<\/li><li><span class='t'>名称：<\/span>{name}<\/li><li><span class='t'>描述：<\/span>{desc}<\/li><li><span class='t'>头像：<\/span><img src='{logo}' class='imgLogo'/><\/li><li><span class='t'>二维码：<\/span><img src='/api/ss/site?method=qcode&mode=team&teamid={id}' /><\/li><li style='display:none'><span class='t'>允许成员数：<\/span>{maxcount}<\/li><li><span class='t'>已加入成员数：<\/span>{added}<\/li><\/ul>".format(e),f=r.getObject("list");f.length>0&&(u+="<table class='bx_gv'><tr class='bx_gv_header'><th class='th1' style='width:120px;'>姓名<\/th><th class='th2' style='width:60px;'>性别<\/th><th class='th3' style='width:130px'>电话<\/th><th class='th4'>Email<\/th><th class='th5' style='width:60px'>支付状态<\/th><\/tr>",f.each(function(n){n.ispayedtext=n.ispayed?"√":"",u+="<tr class='bx_gv_row'><td>{name}<\/a><\/td><td class='n'>{sex}<\/td><td>{mobile}<\/td><td>{email}<\/td><td>{ispayedtext}<\/td><\/tr>".format(n)}),u+="<\/table>"),t.html(u)}else t.html(i)})})}}}(),userBm:function(){var t={pageIndex:1};return{init:function(){var n=this;webPages.site.userCenter.init(function(){n.getList(1)})},getList:function(i){t.pageIndex=i;var r=$(".divMgvList");n.pageAPI("","getmemberbmlist",{pageindex:t.pageIndex},function(n,t,i){n==0?i.getInt("totalcount")==0?r.html("当前没有报名记录"):r.html(i.get("htmltext")):r.html(t)})}}}(),showUserLoginWin:function(t,i){var r=function(){webPages.site.___openwindow=null,i&&i()};return webPages.site.___openwindow=bxOpenWindow("","/"+n.getWords("html","en","jp")+"/memberloginwin.html?cmd=close","width:700px;","right:10px;","scrolling:auto;",r),webPages.site.___openwindow},userAccountSet:function(){var t={mobile:"",email:"",wxnickname:""};return{init:function(){var n=this;$(".divTopBtns .aItemAccountSet").addClass("aItem_selected"),webPages.site.userCenter.init({loaded:function(){$("#aBtnModifyMobile").click(function(){return n.modifyMobile(),!1}),$("#aBtnModifyPsw").click(function(){return n.modifyPsw(),!1}),$("#aBtnModifyWeixinOpen").click(function(){return n.modifyWeixin(),!1}),n.init2()}})},init2:function(){var i=this;n.pageAPI("","memberGetAccountSet",{},function(i,r,u){i==0?(t.mobile=u.get("mobile"),t.email=u.get("email"),t.wxnickname=u.get("wxnickname"),t.mobile==""?($("#spMobile").html("绑定后可以直接使用手机号码登录"),$("#aBtnModifyMobile").html("绑定")):($("#spMobile").html("使用手机号码<span class='num'>"+t.mobile+"<\/span>可以直接登录"),$("#aBtnModifyMobile").html("修改")),t.wxnickname==""?($("#spWeixinOpen").html("绑定后可以直接使用微信扫一扫登录"),$("#aBtnModifyWeixinOpen").html("绑定")):($("#spWeixinOpen").html("使用微信账号<span class='num'>"+t.wxnickname+"<\/span>可以直接登录"),$("#aBtnModifyWeixinOpen").html("修改")),$(".ulTab_waiting").removeClass("ulTab_waiting")):n.showMessage({message:r})})},modifyMobile:function(){var u=this,i=bxPrompt({title:"手机号码",inputs:[{name:"mobile",remark:"新的手机号码"},{name:"vcode",remark:"短信验证码"}],callBackOk:function(t){return t.mobile==""?(n.showMessage({message:"手机号码不能为空"}),!1):t.vcode==""?(n.showMessage({message:"短信验证码不为能空"}),!1):(i.setWaiting(!0),n.userPageAPI("updatemembermobile",t,function(t,r){i.setWaiting(!1),t==0?(n.showMessage({message:"更新成功"},i),u.init2()):n.showMessage({message:r})}),!1)}}),r;i.find("[name=vcode]").css("width","80px"),r=$("<a href='#' class='aBtnSendSmsVerifyCode'>发送验证码<\/a>").insertAfter(i.find("[name=vcode]")),r.click(function(){var u=i.find("[name=mobile]").valText();return u==""?(n.showMessage({message:"手机号码不能为空"}),!1):u==t.mobile?(n.showMessage({message:"新的号码不能为当前号码相同"}),!1):(n.sendSmsVerify({mobile:u,btn:r,type:"modifyregistermobile"}),!1)})},modifyPsw:function(){var i=bxPrompt({title:"修改密码",showloading:!0,callBackOk:function(t){return t.smscode==""||t.psw==""||t.psw2==""?(n.showMessage({message:"请检查输入项"}),!1):t.psw!=t.psw2?(n.showMessage({message:"两次密码不一致"}),!1):(i.setWaiting(!0),n.userPageAPI("updatememberpassword",t,function(t,r){i.setWaiting(!1),t==0?n.showMessage({message:"修改成功"},i):n.showMessage({message:r})}),!1)}}),u=[{name:"psw",remark:"新的密码",type:"password"},{name:"psw2",remark:"确认密码",type:"password"}],r;t.mobile!=""&&u.push({name:"smscode",remark:"短信验证码"}),i.setInputs(u),t.mobile!=""&&(i.find("[name=smscode]").css("width","80px"),r=$("<a href='#' class='aBtnSendSmsVerifyCode'>发送验证码<\/a>").insertAfter(i.find("[name=smscode]")),r.click(function(){return n.sendSmsVerify({mobile:t.mobile,btn:r,type:"modifymemberpassword"}),!1}))},modifyWeixin:function(){var t=new bxQueryString("",!1),i;return t.setValue("cmd","modifybind"),i="https://open.weixin.qq.com/connect/qrconnect?appid="+n.global.wxOpenAppId+"&redirect_uri="+encodeURIComponent(n.global.wxOpenUrlHead+"/html/memberpassport1.html")+"&response_type=code&scope=snsapi_login&state="+encodeURIComponent(t.getQueryString())+"#wechat_redirect",window.location.href=i,!1}}}(),bmTop:function(){return{init:function(){var n=function(){$("A").attr("target","_top")};$(document).ready(function(){n();var t=bxGetUrlParam("class_bd");t.length>0&&$(document.body).addClass(t)}),addOnload(function(){n()})}}}(),downloadPhotoZip:function(){return{init:function(){var n=bxPub.getUrlParam("guid")}}}(),wxChengjiQuery:function(){return{init:function(){var t=$("#txtIDNumber"),r=$("#aBtnQuery"),i=$("#divResultContent"),f=function(){t.css("width",r.offset().left-t.offset().left+"px")},u,e;f(),bxSys.addEvent(window,"onresize",f),bxText.setRemark(t[0],"请输入您的证件号码",!0),r.click(function(){$(".divResult").show();var r=bxText.getValue(t[0]);return r==""?(i.html("请输入您的证件号码然后再点击查询"),!1):(i.html("<div class='loading'><\/div> 正在努力查询，请稍后..."),n.pageAPI("","wxcjquery",{num:r},function(n,t,r){n==0?i.html(r.get("htmltext")):i.html(t)}),window.location.hash="#num="+r,!1)}),u=window.location.hash,u.indexOf("#num")==0&&(e=u.substr(5),t.val(e),r.click())}}}(),wxChengjiZhengshu:function(){return{init:function(){var t=$("#divResultContent"),i=bxGetUrlParam("id");return i==""?(t.html("参数不正确"),!1):(t.html("<div class='loading'><\/div> 正在努力获取证书，请稍后..."),n.pageAPI("","getcjzs",{recordid:i},function(n,i,r){var u,o,e,s,f;n==0?(u=r.get("urlwx"),o=r.get("url"),u!=null&&u.length>0?(e=function(){t.html("<img src='"+u+"' class='imgZs'/><br /><a href='"+o+"' class='aBtnDownload'>高清证书<\/a>");var n=t.find(".imgZs");bxPlugin.run("weixinapi",function(){WeixinApi.ready(function(t){var i={imgUrl:n[0].src,link:window.location.href,desc:"大家好，这是我的成绩证书",title:"大家好，这是我的成绩证书"},r={ready:function(){},cancel:function(){},fail:function(){},confirm:function(){},all:function(){}};t.shareToFriend(i,r),t.shareToTimeline(i,r),t.shareToWeibo(i,r)})},!0)},s=r.getBool("new"),s?(f=new Image,f.onerror=function(){setTimeout(function(){f.src=u},1e3)},f.onload=function(){e()},f.src=u):e()):t.html(r.get("htmltext"))):t.html(i)}),!1)}}}(),cjzs:function(){return{init:function(t){var t=bxPub.extend({name:"成绩证书",urlHead:"http://cdn.ss.chinarun.com"},t||{}),u=bxGetUrlParam("num"),i,r;if(u==""){n.showMessage({message:"参数不正确"});return}(i=$(".divCjzs"),r={projectid:0,num:u},this.onPreQuery&&this.onPreQuery(r)===!1)||n.pageAPI("","getCjzs",r,function(r,u,f){if(r==0){i.addClass("divCjzs_loaded");var e=f.get("url"),o=t.urlHead+e;i.find(".divCnt").html("<img src='{0}' class='imgZsView' />".format(o)),i.find(".aBtnDownload").attr("href",n.getDownloadUrl(e,t.name,t.urlHead)),i.find(".aBtnPrint").click(function(){return window.print(),!1}),$("<img src='"+o+"' class='imgPrint'/>").appendTo(document.body)}else i.find(".divCnt").html(u)})},onPreQuery:function(){return!0}}}(),lqd:function(){return{init:function(t){var t=bxPub.extend({name:"领物单",urlHead:"http://cdn.ss.chinarun.com"},t||{}),u=bxGetUrlParam("num"),i,r;if(u==""){n.showMessage({message:"参数不正确"});return}(i=$(".divLqd"),r={projectid:bxPub.parseInt(bxGetUrlParam("projectid"),0),num:u},this.onPreQuery&&this.onPreQuery(r)===!1)||n.pageAPI("","getLqd",r,function(r,u,f){if(r==0){i.addClass("divLqd_loaded");var e=f.get("url"),o=t.urlHead+e;i.find(".divCnt").html("<img src='{0}' class='imgLqdView' />".format(o)),i.find(".aBtnDownload").attr("href",n.getDownloadUrl(e,t.name,t.urlHead)),i.find(".aBtnPrint").click(function(){return window.print(),!1}),$("<img src='"+o+"' class='imgPrint'/>").appendTo(document.body)}else i.find(".divCnt").html(u)})},onPreQuery:function(){return!0}}}(),shopPdtDetail:function(){var n={id:0,scrollDuration:500},t=$();return{init:function(i){var u,f,r;bxPub.extend(n,i),t=$(".divPdtInfo"),u=$I("txtCartAddCount"),f=$I("divSmallImageScroll"),this.initTab(),this.initSmallList();return},initSmallList:function(){function o(){clearTimeout(f),n.show(),e.show()}function s(){clearTimeout(f),f=setTimeout(function(){n.hide(),e.hide()},100)}var f=0,i=t.find(".imgBig"),e=t.find(".divLargeImage"),r=t.find(".imgLarge"),n=$("<div class='divMoveBorder'><\/div>").appendTo(t.find(".divBigImage")),u;n.css("opacity",.5),i.mousemove(function(){o();var t=i.xy(),r=bxPub.getMousePosition(bxSys.getEvent());n.css("left",r.x-t.x-n[0].offsetWidth/2+"px"),n.css("top",r.y-t.y-n[0].offsetHeight/2+"px")}),u=t.find(".divThumbnailList img"),u.click(function(){u.removeClass("selected");var n=$(this);n.addClass("selected"),r[0].src=i[0].src=n.p("big")}),r.css("width",i[0].offsetWidth*i[0].offsetWidth/n[0].offsetWidth+"px"),r.css("height",i[0].offsetHeight*i[0].offsetHeight/n[0].offsetHeight+"px"),n[0].onmousemove=function(){o();var t=i.xy(),e=bxPub.getMousePosition(bxSys.getEvent()),u=Math.min(i[0].offsetWidth-n[0].offsetWidth,e.x-t.x-n[0].offsetWidth/2),f=Math.min(i[0].offsetHeight-n[0].offsetHeight,e.y-t.y-n[0].offsetHeight/2);u=Math.max(0,u),f=Math.max(0,f),n.css("left",u+"px"),n.css("top",f+"px");var s=n.xy(),h=(s.x-t.x)/(i[0].offsetWidth-n[0].offsetWidth),c=(s.y-t.y)/(i[0].offsetHeight-n[0].offsetHeight);r.css("left",0-(r[0].offsetWidth-r[0].parentNode.offsetWidth)*h+"px"),r.css("top",0-(r[0].offsetHeight-r[0].parentNode.offsetHeight)*c+"px")},i[0].onmouseout=function(){s()},n[0].onmouseout=function(){s()},u[0].click()},initTab:function(){var t=$(".divPdtTab"),i=t.find(".divTabTitle"),r=bxGetBodyDocumentElement(),n=function(){var n=Math.max(0,r.scrollTop-t.xy().y);i.css("top",n+"px")};bxSys.addEvent(window,"onscroll",n),bxSys.addEvent(window,"onresize",n),n()},getEvaluationList:function(t,i){var i=i||1,r={pid:n.id,pageindex:i};bxProduct.pageAPI("getEvaluationList",r,function(n,i,r){n==0?($I("divEvalList"+t).html(r.get("htmltext")),$I("spEvalCountTotal").html(r.get("totalcount")),webHelper.autoSetFen()):alert(i)})}}}(),wxOpenId:function(){return{init:function(){var u=bxPub.getUrlParam("openid"),f=bxPub.getUrlParam("cache"),t=bxPub.getUrlParam("scope"),n=bxPub.getUrlParam("appid"),i=bxPub.parseInt(bxPub.getUrlParam("uid"),0),r;t==""&&(t="snsapi_base"),f=="local"&&bxNavigator.weixin?(window.localStorage.setItem(n+"_weixinopenid_"+t,u),window.localStorage.setItem(n+"_weixinopenid_"+t+"_expiretime",(new Date).addDays(10).format("yyyy/MM/dd HH:mm:ss")),i>0&&(window.localStorage.setItem(n+"_weixinopenid_weixinmemberid",i.toString()),window.localStorage.setItem(n+"_weixinopenid_weixinmemberid_expiretime",(new Date).addDays(10).format("yyyy/MM/dd HH:mm:ss")))):(bxPub.sessionStorageSetItem(n+"_weixinopenid_"+t,u),i>0&&bxPub.sessionStorageSetItem(n+"_weixinmemberid",i.toString())),r=bxPub.sessionStorageGetItem("ReturnUrl"),r?(bxPub.sessionStorageRemoveItem("ReturnUrl"),window.location.href=r):document.referrer?window.location.href=document.referrer:document.body.innerHTML="非法参数"}}}(),wxLogin:function(){return{init:function(){bxPageAPI("","wxlogin",{},function(t,i,r){if(t==0){var u=r.get("url");window.location.href=u}else n.showMessage({message:"登录失败："+i,onClosed:function(){window.location.href="wxopenid.html"}})})}}}(),visitAuthorization:function(){return{init:function(){var t=function(n){var t=60,i;return $(n).attr("disabled","true"),i=setInterval(function(){t--,$(n).html("重新发送"+t).css("background","#ccc"),t==0&&($(n).removeAttr("disabled"),$(n).html("发送验证码").css("background","#3c3c3c"),t=60,clearInterval(i))},1e3),!1};$("#sendTelCode").click(function(){var i=$.trim($("#phone").val());if(!/^1\d{10}$/.test(i))return n.showMessage({title:"提示",message:"请输入正确的手机格式"}),!1;bxPageAPI("","authorizationverificationcode",{number:i,numbertype:"mobile"},function(i,r){console.log(i),i==0?(t("#sendTelCode"),n.showMessage({title:"提示",message:"发送验证码成功"})):n.showMessage({title:"提示",message:r})})}),$("#telSubmit").click(function(){var t=$.trim($("#phone").val()),i=$.trim($("#telCode").val()),r=bxGetUrlParam("return_url");bxPageAPI("","authorizationrecordwrite",{number:t,numbertype:"mobile",ecode:i},function(t,i){console.log(t),t==0?window.location.href=r:n.showMessage({title:"提示",message:i})})}),$("#sendEmailCode").click(function(){var i=$.trim($("#email").val());if(!/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/.test(i))return n.showMessage({title:"提示",message:"请输入正确的邮箱格式"}),!1;console.log(i),bxPageAPI("","authorizationverificationcode",{number:i,numbertype:"email"},function(i,r){console.log(i),i==0?(t("#sendEmailCode"),n.showMessage({title:"提示",message:"发送验证码成功"})):n.showMessage({title:"提示",message:r})})}),$("#emailSubmit").click(function(){var t=$.trim($("#email").val()),i=$.trim($("#emailCode").val()),r=bxGetUrlParam("return_url");console.log(i),console.log(t),bxPageAPI("","authorizationrecordwrite",{number:t,numbertype:"email",ecode:i},function(t,i){console.log(t),t==0?window.location.href=r:n.showMessage({title:"提示",message:i})})}),$("#sendRightcode").click(function(){var t=$.trim($("#rightCode").val()),i=bxGetUrlParam("return_url");bxPageAPI("","authorizationrecordwrite",{number:t,numbertype:"code",ecode:""},function(t,r){console.log(t),t==0?window.location.href=i:n.showMessage({title:"提示",message:r})})})}}}()},n=i.funs;return n.addResize(function(){var u=bxGetBodyDocumentElement(),t=$(".divPageMainTop"),i=$(".divPageMainMiddle"),r=$(".divPageMainBottom"),n;t.length>0&&i.length>0&&r.length>0&&(n=u.clientHeight-t[0].offsetHeight-r[0].offsetHeight,n>0&&i.css("minHeight",n+"px"))}),n.initResize(),$("document").ready(function(){n.visitLogInit()}),i}())